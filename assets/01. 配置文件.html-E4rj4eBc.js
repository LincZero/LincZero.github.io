import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as i,o as p,c,a as n,b as a,d as s,e as l}from"./app-D9NcyM5y.js";const o={},d=n("h1",{id:"rime-配置文件",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rime-配置文件"},[n("span",null,"Rime 配置文件")])],-1),u={href:"https://docs.nopdan.com/rime/Configuration.html#%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"},r={href:"https://docs.nopdan.com/rime/Configuration.html#%E4%BD%8D%E7%BD%AE%E5%8F%8A%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"},m={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%8C%85%E5%90%AB",target:"_blank",rel:"noopener noreferrer"},k={href:"https://docs.nopdan.com/rime/Configuration.html#%E8%A1%A5%E9%9D%AA",target:"_blank",rel:"noopener noreferrer"},v={href:"https://docs.nopdan.com/rime/Configuration.html#%E7%94%A8%E8%A1%A5%E9%9D%AA%E6%8C%87%E4%BB%A4%E4%BF%AE%E6%94%B9%E5%88%97%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"},_={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%8F%AF%E9%80%89%E7%9A%84%E5%8C%85%E5%90%AB%E4%B8%8E%E8%A1%A5%E9%9D%AA",target:"_blank",rel:"noopener noreferrer"},h={href:"https://docs.nopdan.com/rime/Configuration.html#%E8%BF%BD%E5%8A%A0%E4%B8%8E%E5%90%88%E5%B9%B6",target:"_blank",rel:"noopener noreferrer"},b={href:"https://docs.nopdan.com/rime/Configuration.html#%E8%87%AA%E5%8A%A8%E5%BA%94%E7%94%A8%E8%A1%A5%E9%9D%AA",target:"_blank",rel:"noopener noreferrer"},y={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%BA%94%E7%94%A8%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"},g={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%AF%BC%E5%85%A5%E6%88%90%E5%A5%97%E7%BB%84%E4%BB%B6%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"},f={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%AF%BC%E5%85%A5%E9%9F%B5%E4%B9%A6%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"},E={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},A={href:"https://docs.nopdan.com/rime/Configuration.html#%E9%85%8D%E7%BD%AE%E7%BB%84%E4%BB%B6%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"},B={href:"https://docs.nopdan.com/rime/Configuration.html#%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC",target:"_blank",rel:"noopener noreferrer"},x={href:"https://docs.nopdan.com/rime/Configuration.html#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86",target:"_blank",rel:"noopener noreferrer"},C={href:"https://docs.nopdan.com/rime/Configuration.html#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6",target:"_blank",rel:"noopener noreferrer"},D={href:"https://docs.nopdan.com/rime/Configuration.html#%E5%88%86%E5%8F%91",target:"_blank",rel:"noopener noreferrer"},M=n("p",null,"Rime 配置文件，用于设置输入法引擎、输入法客户端的运行参数，也包括输入方案及词典配置。",-1),L=n("h2",{id:"介绍",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#介绍"},[n("span",null,"介绍")])],-1),F=n("h3",{id:"文件格式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#文件格式"},[n("span",null,"文件格式")])],-1),Y={href:"http://yaml.org/",target:"_blank",rel:"noopener noreferrer"},w=n("h3",{id:"位置及组织方式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#位置及组织方式"},[n("span",null,"位置及组织方式")])],-1),R=n("p",null,"Rime 所使用的配置文件在 [[用户文件夹|UserData]] 及 [[共享文件夹|SharedData]]。",-1),z=n("h2",{id:"语法-yaml超集",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#语法-yaml超集"},[n("span",null,"语法 (YAML超集)")])],-1),N={href:"http://yaml.org/",target:"_blank",rel:"noopener noreferrer"},T=l(`<ul><li>包含， __include</li><li>补丁， __path</li><li>追加， __append</li></ul><h3 id="包含-include" tabindex="-1"><a class="header-anchor" href="#包含-include"><span>包含 (__include)</span></a></h3><p><code>__include:</code> 指令在当前位置包含另一 YAML 节点的内容。</p><p>可写在配置源文件任一 YAML map 节点下。其语法为</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">include_example_1</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> local/node

<span class="token key atrule">local</span><span class="token punctuation">:</span>
  <span class="token key atrule">node</span><span class="token punctuation">:</span> contents to include
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>被引用的节点可以来自另一个配置文件。 目标配置节点的路径以 <code>&lt;filename&gt;:/</code> 开始，可省略扩展名 <code>.yaml</code>。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">include_example_2</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> config<span class="token punctuation">:</span>/external/node

<span class="token key atrule">include_example_3</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> config.yaml<span class="token punctuation">:</span>/external/node
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>包含整个文件，可指定路径为目标配置文件的根节点：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">include_example_4</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> config.yaml<span class="token punctuation">:</span>/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>包含另一个 YAML map 节点后，源文件中 <code>__include:</code> 指令所在 map 除编译指令外的其他数据与被包含的 map 合并：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">include_example_5</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> some_map
  <span class="token key atrule">occupation</span><span class="token punctuation">:</span> journalist <span class="token comment"># new key and value</span>
  <span class="token key atrule">simplicity</span><span class="token punctuation">:</span> very <span class="token comment"># override value for included key</span>

<span class="token key atrule">some_map</span><span class="token punctuation">:</span>
  <span class="token key atrule">simplicity</span><span class="token punctuation">:</span> somewhat
  <span class="token key atrule">naivety</span><span class="token punctuation">:</span> sometimes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>合并发生在 <code>__include:</code> 指令所在节点，不会修改被引用节点 <code>some_map</code> 的内容。</p><p>包含 YAML 列表，则指令所在 map 节点替换为所引用的 YAML 列表。 该 map 节点不应包含任何编译指令以外的 key-value，因为不相容于 YAML 列表类型。</p><p>也不能直接在该节点下追加列表项，因为 YAML 语法不允许混合 map 与 list。 在包含列表后追加、修改列表项，必须使用下文介绍的 <code>__append:</code> 或 <code>__patch:</code> 指令。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">include_example_6</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> some_list
  <span class="token key atrule">__append</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> someone else

<span class="token key atrule">some_list</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> youngster
  <span class="token punctuation">-</span> elder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="补丁-patch" tabindex="-1"><a class="header-anchor" href="#补丁-patch"><span>补丁 (__patch)</span></a></h3><p>修改某一相对路径下的配置节点，而非当前节点的整体。 基本语法为：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">__patch</span><span class="token punctuation">:</span>
  <span class="token key atrule">key/alpha</span><span class="token punctuation">:</span> value A
  <span class="token key atrule">key/beta</span><span class="token punctuation">:</span> value B
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目标节点路径的写法为将各级 map 的 key 用 <code>/</code> 分隔。 因此 <code>key</code> 如果包含 <code>/</code> 字符，则不能作为节点路径的一部分。</p><p>可在节点路径末尾添加 <code>/+</code> 操作符，表示合并 list 或 map 节点； 或者（可选地）添加 <code>/=</code> 表示用指定的值替换目标节点原有的值。 若未指定操作符，<code>__patch:</code> 指令的默认操作为替换。</p><p>以下是一些示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_example_1</span><span class="token punctuation">:</span>
  <span class="token key atrule">sibling</span><span class="token punctuation">:</span> old value
  <span class="token key atrule">append_to_list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> existing item
  <span class="token key atrule">merge_with_map</span><span class="token punctuation">:</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> value
  <span class="token key atrule">replace_list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> item 1
    <span class="token punctuation">-</span> item 2
  <span class="token key atrule">replace_map</span><span class="token punctuation">:</span>
    <span class="token key atrule">a</span><span class="token punctuation">:</span> value
    <span class="token key atrule">b</span><span class="token punctuation">:</span> value
  <span class="token key atrule">__patch</span><span class="token punctuation">:</span>
    <span class="token key atrule">sibling</span><span class="token punctuation">:</span> new value
    <span class="token key atrule">append_to_list/+</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> appended item
    <span class="token key atrule">merge_with_map/+</span><span class="token punctuation">:</span>
      <span class="token key atrule">key</span><span class="token punctuation">:</span> new value
      <span class="token key atrule">new_key</span><span class="token punctuation">:</span> value
    <span class="token key atrule">replace_list/=</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> only item
    <span class="token key atrule">replace_map/=</span><span class="token punctuation">:</span>
      <span class="token key atrule">only_key</span><span class="token punctuation">:</span> value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上示例仅为表现 <code>__patch:</code> 的作用方式。 实际上在当前节点和补靪内容均为字面值的情况下，没有打补靪的必要。 字面值补靪通常用于当前节点包含了其他节点，并需要修改部份配置项的场景：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_example_2</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> patch_example_1
  <span class="token key atrule">__patch</span><span class="token punctuation">:</span>
    <span class="token key atrule">sibling</span><span class="token punctuation">:</span> even newer value
    <span class="token key atrule">append_to_list/+</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> another appended item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于 YAML map 的 key 是无序的，书写顺序并不决定编译指令的先后。</p><p>同一节点下，编译指令的执行顺序为： <code>__include:</code> 包含指定节点 → 合并当前节点下的其他 key-value 数据 → <code>__patch:</code> 修改子节点。</p><p><code>__patch:</code> 指令的另一种主要用法是引用另一个节点中的补靪内容，并作用于指令所在节点：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_example_3</span><span class="token punctuation">:</span>
  <span class="token key atrule">__patch</span><span class="token punctuation">:</span> changes
  <span class="token key atrule">some_list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> youngster
    <span class="token punctuation">-</span> elder
  <span class="token key atrule">some_map</span><span class="token punctuation">:</span>
    <span class="token key atrule">simplicity</span><span class="token punctuation">:</span> somewhat
    <span class="token key atrule">naivety</span><span class="token punctuation">:</span> sometimes

<span class="token key atrule">changes</span><span class="token punctuation">:</span>
  <span class="token key atrule">some_list/+</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> someone else
  <span class="token key atrule">some_map/simplicity</span><span class="token punctuation">:</span> too much
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>YAML 语法不允许 map 有重复的 key。 如果要引用不同位置的多项补靪，可以为 <code>__patch:</code> 指定一个列表，其中每项通过节点引用定义一组补靪：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_example_4</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> base_config
  <span class="token key atrule">__patch</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> company_standard
    <span class="token punctuation">-</span> team_convention
    <span class="token punctuation">-</span> personal_preference

<span class="token key atrule">base_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">actors</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">company_info</span><span class="token punctuation">:</span>
    <span class="token key atrule">based_in</span><span class="token punctuation">:</span> unknown location
  <span class="token key atrule">favorites</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token key atrule">company_standard</span><span class="token punctuation">:</span>
  <span class="token key atrule">company_info/based_in</span><span class="token punctuation">:</span> american san diego

<span class="token key atrule">team_convention</span><span class="token punctuation">:</span>
  <span class="token key atrule">actors/+</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> feifei
    <span class="token punctuation">-</span> meimei
    <span class="token punctuation">-</span> riri

<span class="token key atrule">personal_preference</span><span class="token punctuation">:</span>
  <span class="token key atrule">favorites/fertilizer</span><span class="token punctuation">:</span> jinkela
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="用补丁指令修改列表" tabindex="-1"><a class="header-anchor" href="#用补丁指令修改列表"><span>用补丁指令修改列表</span></a></h4><p>补靪指令中，目标节点路径由各级节点的 key 组成。 若某一节点为 list 类型，可以 <code>@&lt;下标&gt;</code> 形式指定列表项。下标从 0 开始计数。 无论列表长度，末位列表元素可表示为 <code>@last</code>。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_list_example_1</span><span class="token punctuation">:</span>
  <span class="token key atrule">some_list/@0/simplicity</span><span class="token punctuation">:</span> very
  <span class="token key atrule">some_list/@last/naivety</span><span class="token punctuation">:</span> always

<span class="token key atrule">some_list</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">simplicity</span><span class="token punctuation">:</span> somewhat
  <span class="token punctuation">-</span> <span class="token key atrule">naivety</span><span class="token punctuation">:</span> sometimes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在指定元素之前、之后插入列表元素，用 <code>@before &lt;下标&gt;</code>、<code>@after &lt;下标&gt;</code>。 <code>@after last</code> 可简写为 <code>@next</code>，向列表末尾添加元素：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">patch_list_example_2</span><span class="token punctuation">:</span>
  <span class="token key atrule">&#39;some_list/@before 0/youthfulness&#39;</span><span class="token punctuation">:</span> too much
  <span class="token key atrule">&#39;some_list/@after last/velocity&#39;</span><span class="token punctuation">:</span> greater than westerners
  <span class="token key atrule">some_list/@next/questions</span><span class="token punctuation">:</span> no good
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="可选的包含与补靪" tabindex="-1"><a class="header-anchor" href="#可选的包含与补靪"><span>可选的包含与补靪</span></a></h4><p>若包含或补靪指令的目标是以 <code>?</code> 结尾的节点路径， 则当该路径对应的节点（或所属外部配置文件）不存在时，不产生编译错误。</p><p>如：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">__patch</span><span class="token punctuation">:</span> default.custom<span class="token punctuation">:</span>/patch<span class="token punctuation">?</span>

<span class="token key atrule">nice_to_have</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> optional_config<span class="token punctuation">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="追加与合并-append" tabindex="-1"><a class="header-anchor" href="#追加与合并-append"><span>追加与合并 (__append)</span></a></h3><p>追加指令 <code>__append:</code> 将其下的列表项追加到该指令所在的节点。 合并指令 <code>__merge:</code> 将其下的 map 合并到该指令所在的节点。</p><p>这两条指令只能用在 <code>__include:</code> 指令所在节点及其（字面值）子节点。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">append_merge_example_1</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> starcraft
  <span class="token key atrule">__merge</span><span class="token punctuation">:</span>
    <span class="token key atrule">made_by</span><span class="token punctuation">:</span> blizzard entertainment
    <span class="token key atrule">races</span><span class="token punctuation">:</span>
      <span class="token key atrule">__append</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> protoss
        <span class="token punctuation">-</span> zerg

<span class="token key atrule">starcraft</span><span class="token punctuation">:</span>
  <span class="token key atrule">first_release</span><span class="token punctuation">:</span> <span class="token number">1998</span>
  <span class="token key atrule">races</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> terrans
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际书写配置时，<code>__merge:</code> 指令往往省略。 因为 <code>__include:</code> 指令自动合并其所在节点下的 key-value 并递归地合并所有 map 类型的子节点。</p><p>而对于类型为 list 的子节点，默认操作是替换整个列表。 如果要以向后追加列表项的方式合并，除了 <code>__append:</code> 指令之外，还可以采用 <code>/+</code> 操作符：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">append_merge_example_2</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> starcraft
  <span class="token key atrule">made_by</span><span class="token punctuation">:</span> blizzard entertainment
  <span class="token key atrule">races/+</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> protoss
    <span class="token punctuation">-</span> zerg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>__include:</code> 指令自动合并的节点树中，如果要对某个 map 类型的子节点整体替换，可使用 <code>/=</code> 操作符：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">revealed_map</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> old_map
  <span class="token key atrule">terran_command_center/=</span><span class="token punctuation">:</span>
    <span class="token key atrule">x</span><span class="token punctuation">:</span> <span class="token number">3.14</span>
    <span class="token key atrule">y</span><span class="token punctuation">:</span> <span class="token number">6.28</span>
<span class="token key atrule">old_map</span><span class="token punctuation">:</span>
  <span class="token key atrule">terran_command_center</span><span class="token punctuation">:</span>
    <span class="token key atrule">location</span><span class="token punctuation">:</span> unexplored
  <span class="token key atrule">protoss_nexus</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">x</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token key atrule">y</span><span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">}</span>
  <span class="token key atrule">zerg_hatchary</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>x <span class="token punctuation">-</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token key atrule">y</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>案例解析：</p><ul><li>https://github.com/rime/librime/pull/192#issuecomment-371202389</li></ul><h2 id="配置编译器插件" tabindex="-1"><a class="header-anchor" href="#配置编译器插件"><span>配置编译器插件</span></a></h2><p>自动添加一些隐含的编译指令，用来实现对原有补靪机制以及导入成套组件配置等语法的兼容。</p><p>这些插件的作用是将当前输入方案所需的全部配置内容在部署期间汇总到一份编译结果文件里。使输入法程序不必在运行时打开众多的配置文件。</p><h3 id="自动应用补补丁" tabindex="-1"><a class="header-anchor" href="#自动应用补补丁"><span>自动应用补补丁</span></a></h3><p>配置文件的根节点如果没有使用 <code>__patch:</code> 指令，则在源文件编译完成后，自动插入以下指令：</p><p>（注：请将实际的配置名称代入 <code>&lt;config&gt;</code>）</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点</span>
<span class="token key atrule">__patch</span><span class="token punctuation">:</span> &lt;config<span class="token punctuation">&gt;</span>.custom<span class="token punctuation">:</span>/patch<span class="token punctuation">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果存在与旧版本 librime 兼容的补靪文件，则从中加载补靪：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># &lt;config&gt;.custom.yaml</span>
<span class="token key atrule">patch</span><span class="token punctuation">:</span>
  <span class="token key atrule">key</span><span class="token punctuation">:</span> value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上插件的效果相当于</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点</span>
<span class="token key atrule">__patch</span><span class="token punctuation">:</span>
  <span class="token key atrule">key</span><span class="token punctuation">:</span> value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果源文件的根节点使用了 <code>__patch:</code> 指令，则不论其是否加载 <code>&lt;config&gt;.custom:/patch</code>，都不再添加自动补靪指令。 如果这种情况下仍希望支持补靪文件，须将其列为 <code>__patch:</code> 列表中的一项：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点</span>
<span class="token key atrule">__patch</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> other_patch <span class="token comment"># ...</span>
  <span class="token punctuation">-</span> &lt;config<span class="token punctuation">&gt;</span>.custom<span class="token punctuation">:</span>/patch<span class="token punctuation">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="应用默认配置" tabindex="-1"><a class="header-anchor" href="#应用默认配置"><span>应用默认配置</span></a></h3><p>输入方案中未指定以下配置项时，自动导入默认配置 <code>default.yaml</code> 的定义：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">menu</span><span class="token punctuation">:</span>
  <span class="token key atrule">page_size</span><span class="token punctuation">:</span> <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="导入成套组件配置" tabindex="-1"><a class="header-anchor" href="#导入成套组件配置"><span>导入成套组件配置</span></a></h3><p>将部份组件配置中的 <code>&lt;component&gt;/import_preset: &lt;config&gt;</code> 语法翻译为</p><p>（注：请将实际的配置名称和组件名称代入 <code>&lt;config&gt;</code>、<code>&lt;component&gt;</code>）</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">&lt;component&gt;</span><span class="token punctuation">:</span>
  <span class="token key atrule">__include</span><span class="token punctuation">:</span> &lt;config<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>/&lt;component<span class="token punctuation">&gt;</span>
  <span class="token comment"># 以下为输入方案覆盖定义的内容</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：如果指定的配置节点 <code>&lt;config&gt;:/&lt;component&gt;</code> 不存在会导致输入方案编译错误。</p><h3 id="导入韵书配置" tabindex="-1"><a class="header-anchor" href="#导入韵书配置"><span>导入韵书配置</span></a></h3><p>（尚未实现）导入 <code>*.dict.yaml</code> 的 YAML 配置部份。</p><h2 id="加载规则" tabindex="-1"><a class="header-anchor" href="#加载规则"><span>加载规则</span></a></h2><p>以上介绍的编译指令及编译器插件，仅对交给 <em>配置编译器</em> 处理的 <em>源文件</em> 有效。</p><p>配置源文件的位置详见 [[用户文件夹|UserData]] 及 [[共享文件夹|SharedData]]。</p><p>输入法程序运行时读取的配置文件是 <em>编译结果文件</em>（可能是 YAML 格式或二进制格式）。 编译结果只包含直接供程序读取的配置内容，而不再包含有特殊含义的编译指令。</p><p>配置的编译结果文件与源文件并非一一对应的关系， 而是合并重组为编译后的默认配置 <code>default</code> 以及各输入方案的配置。</p><p>其他不经过编译处理而直接在运行时由输入法程序存取的配置文件有： <code>installation.yaml</code>, <code>user.yaml</code> 等。</p><p><em>韵书</em> 文件中的 YAML 配置部份目前也不支持配置编译指令。</p><p>TODO(rime/docs): 详解 YAML 节点树及编译指令的解析、执行顺序</p><h2 id="配置组件调用方式" tabindex="-1"><a class="header-anchor" href="#配置组件调用方式"><span>配置组件调用方式</span></a></h2><p>TODO(rime/engine): 完成本节</p><h2 id="代码风格" tabindex="-1"><a class="header-anchor" href="#代码风格"><span>代码风格</span></a></h2>`,84),O={href:"http://yaml.org/",target:"_blank",rel:"noopener noreferrer"},I=l('<p>配置文件开头用注释行简述文件的内容和使用方法。</p><p>缩进：用两个空格缩进。</p><p>字符串值：无特殊字符时不使用引号； 需要使用引号时，优先用单引号，以减少双引号引起的字符转义问题。</p><p>flow-style list: 仅在节点树的最内层使用。不嵌套使用。元素较多时不用。</p><p>flow-style map: 仅在节点树的最内层使用。不嵌套使用。元素较多时不用。</p><p>仅包含一对 key-value 的 map 作为列表项时，省略 <code>{ }</code> 并与 <code>-</code> 写在同一行。</p><p>不推荐使用 YAML 的锚点（<code>&amp;</code>）和别名引用（<code>*</code>）。请用本文介绍的 <code>__include:</code> 编译指令。</p><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理"><span>错误处理</span></a></h2>',8),S=n("code",null,"INFO",-1),V={href:"https://github.com/rime/home/wiki/RimeWithSchemata#%E5%85%B3%E4%BA%8E%E8%B0%83%E8%AF%95",target:"_blank",rel:"noopener noreferrer"},P=n("code",null,"E",-1),U=l('<p>未出现错误信息，配置亦未达到预期效果，请对照 <code>&lt;用户文件夹&gt;/build/</code> 文件夹内的编译结果文件，检查配置源文件与补靪。</p><h2 id="版本控制" tabindex="-1"><a class="header-anchor" href="#版本控制"><span>版本控制</span></a></h2><p>输入方案及配置的版本可以用文件中的一项 <em>字符串值</em> 记录。如：<code>version: &#39;3.14&#39;</code></p><p>版本号习惯以形为 <code>X.Y.Z</code> 的多个数字组成。 为避免将版本号解析为 YAML 数值类型而发生错误，如 <code>0.10</code>（〇点十）不同于 <code>0.1</code>（〇点一）， 应一律为版本号加上引号 <code>&#39;3.14&#39;</code> 以示其为字符串类型。</p><h2 id="分发" tabindex="-1"><a class="header-anchor" href="#分发"><span>分发</span></a></h2>',5),j={href:"https://github.com",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/rime/plum",target:"_blank",rel:"noopener noreferrer"};function G(H,J){const e=i("ExternalLinkIcon");return p(),c("div",null,[d,n("ul",null,[n("li",null,[a("Rime 配置文件 "),n("ul",null,[n("li",null,[n("a",u,[a("文件格式"),s(e)])]),n("li",null,[n("a",r,[a("位置及组织方式"),s(e)])]),n("li",null,[a("语法 "),n("ul",null,[n("li",null,[n("a",m,[a("包含"),s(e)])]),n("li",null,[n("a",k,[a("补靪"),s(e)])]),n("li",null,[n("a",v,[a("用补靪指令修改列表"),s(e)])]),n("li",null,[n("a",_,[a("可选的包含与补靪"),s(e)])]),n("li",null,[n("a",h,[a("追加与合并"),s(e)])])])]),n("li",null,[a("配置编译器插件 "),n("ul",null,[n("li",null,[n("a",b,[a("自动应用补靪"),s(e)])]),n("li",null,[n("a",y,[a("应用默认配置"),s(e)])]),n("li",null,[n("a",g,[a("导入成套组件配置"),s(e)])]),n("li",null,[n("a",f,[a("导入韵书配置"),s(e)])])])]),n("li",null,[n("a",E,[a("加载规则"),s(e)])]),n("li",null,[n("a",A,[a("配置组件调用方式"),s(e)])]),n("li",null,[n("a",B,[a("代码风格"),s(e)])]),n("li",null,[n("a",x,[a("错误处理"),s(e)])]),n("li",null,[n("a",C,[a("版本控制"),s(e)])]),n("li",null,[n("a",D,[a("分发"),s(e)])])])])]),M,L,F,n("p",null,[a("采用 UTF-8 编码的 "),n("a",Y,[a("YAML"),s(e)]),a(" 文本。")]),w,R,z,n("p",null,[a("在 "),n("a",N,[a("YAML"),s(e)]),a(" 语法的基础上，增设以下编译指令：")]),T,n("p",null,[a("YAML 书写样式参照 "),n("a",O,[a("yaml.org"),s(e)]),a(" 的示例。推荐以下风格：")]),I,n("p",null,[a("部署后出现错误，请查看 "),S,a(" 日志（"),n("a",V,[a("参考"),s(e)]),a("）， 找到行首字符为 "),P,a(" 的记录，根据错误信息以及上下文排查出错的配置文件。")]),U,n("p",null,[a("输入方案设计师完成输入方案及配套韵书后，将源文件发布在一间 "),n("a",j,[a("GitHub"),s(e)]),a(" 代码库， 用家便可通过 Rime 配置管理工具 "),n("a",q,[a("东风破"),s(e)]),a(" 获取输入方案的最新版本并安装到输入法。")])])}const Z=t(o,[["render",G],["__file","01. 配置文件.html.vue"]]),K=JSON.parse('{"path":"/MdNote_Public/03.%20%E7%94%9F%E6%B4%BB%E6%8A%80%E8%83%BD%E4%B8%8E%E7%94%9F%E6%B4%BB%E7%94%9F%E4%BA%A7/%E8%BE%93%E5%85%A5%E6%B3%95/RIME/01.%20%E6%96%87%E6%A1%A3/03.%20%E8%BF%9B%E9%98%B6/01.%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html","title":"Rime 配置文件","lang":"zh-CN","frontmatter":{"feed":false,"seo":false,"head":[]},"headers":[{"level":1,"title":"Rime 配置文件","slug":"rime-配置文件","link":"#rime-配置文件","children":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[{"level":3,"title":"文件格式","slug":"文件格式","link":"#文件格式","children":[]},{"level":3,"title":"位置及组织方式","slug":"位置及组织方式","link":"#位置及组织方式","children":[]}]},{"level":2,"title":"语法  (YAML超集)","slug":"语法-yaml超集","link":"#语法-yaml超集","children":[{"level":3,"title":"包含  (__include)","slug":"包含-include","link":"#包含-include","children":[]},{"level":3,"title":"补丁 (__patch)","slug":"补丁-patch","link":"#补丁-patch","children":[{"level":4,"title":"用补丁指令修改列表","slug":"用补丁指令修改列表","link":"#用补丁指令修改列表","children":[]},{"level":4,"title":"可选的包含与补靪","slug":"可选的包含与补靪","link":"#可选的包含与补靪","children":[]}]},{"level":3,"title":"追加与合并 (__append)","slug":"追加与合并-append","link":"#追加与合并-append","children":[]}]},{"level":2,"title":"配置编译器插件","slug":"配置编译器插件","link":"#配置编译器插件","children":[{"level":3,"title":"自动应用补补丁","slug":"自动应用补补丁","link":"#自动应用补补丁","children":[]},{"level":3,"title":"应用默认配置","slug":"应用默认配置","link":"#应用默认配置","children":[]},{"level":3,"title":"导入成套组件配置","slug":"导入成套组件配置","link":"#导入成套组件配置","children":[]},{"level":3,"title":"导入韵书配置","slug":"导入韵书配置","link":"#导入韵书配置","children":[]}]},{"level":2,"title":"加载规则","slug":"加载规则","link":"#加载规则","children":[]},{"level":2,"title":"配置组件调用方式","slug":"配置组件调用方式","link":"#配置组件调用方式","children":[]},{"level":2,"title":"代码风格","slug":"代码风格","link":"#代码风格","children":[]},{"level":2,"title":"错误处理","slug":"错误处理","link":"#错误处理","children":[]},{"level":2,"title":"版本控制","slug":"版本控制","link":"#版本控制","children":[]},{"level":2,"title":"分发","slug":"分发","link":"#分发","children":[]}]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":9.44,"words":2831},"filePathRelative":"MdNote_Public/03. 生活技能与生活生产/输入法/RIME/01. 文档/03. 进阶/01. 配置文件.md"}');export{Z as comp,K as data};
