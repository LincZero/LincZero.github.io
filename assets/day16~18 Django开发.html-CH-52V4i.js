import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,a as t}from"./app-Bh75ISgc.js";const p="/assets/image-20211127152344329-C7-ENHBJ.png",e={},o=t(`<h1 id="django" tabindex="-1"><a class="header-anchor" href="#django"><span>Django</span></a></h1><h1 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h1><h1 id="day16-django开发" tabindex="-1"><a class="header-anchor" href="#day16-django开发"><span>day16 Django开发</span></a></h1><p>主题：员工管理系统</p><h2 id="_1-新建项目" tabindex="-1"><a class="header-anchor" href="#_1-新建项目"><span>1.新建项目</span></a></h2><p>![image-20211125083543235](day18 Django开发.assets/image-20211125083543235.png)</p><p>![image-20211125083701911](day18 Django开发.assets/image-20211125083701911.png)</p><h2 id="_2-创建app" tabindex="-1"><a class="header-anchor" href="#_2-创建app"><span>2.创建app</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>python manage.py startapp app01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![image-20211125084115717](day18 Django开发.assets/image-20211125084115717.png)</p><p>注册app：</p><p>![image-20211125084246174](day18 Django开发.assets/image-20211125084246174.png)</p><h2 id="_3-设计表结构-django" tabindex="-1"><a class="header-anchor" href="#_3-设计表结构-django"><span>3.设计表结构（django）</span></a></h2><p>![image-20211125092320247](day18 Django开发.assets/image-20211125092320247.png)</p><p>![image-20211125092904544](day18 Django开发.assets/image-20211125092904544.png)</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 部门表 &quot;&quot;&quot;</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;标题&#39;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 员工表 &quot;&quot;&quot;</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;姓名&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;年龄&quot;</span><span class="token punctuation">)</span>
    account <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;账户余额&quot;</span><span class="token punctuation">,</span> max_digits<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;入职时间&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 无约束</span>
    <span class="token comment"># depart_id = models.BigIntegerField(verbose_name=&quot;部门ID&quot;)</span>
    <span class="token comment"># 1.有约束</span>
    <span class="token comment">#   - to，与那张表关联</span>
    <span class="token comment">#   - to_field，表中的那一列关联</span>
    <span class="token comment"># 2.django自动</span>
    <span class="token comment">#   - 写的depart</span>
    <span class="token comment">#   - 生成数据列 depart_id</span>
    <span class="token comment"># 3.部门表被删除</span>
    <span class="token comment"># ### 3.1 级联删除</span>
    depart <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Department&quot;</span><span class="token punctuation">,</span> to_field<span class="token operator">=</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    <span class="token comment"># ### 3.2 置空</span>
    <span class="token comment"># depart = models.ForeignKey(to=&quot;Department&quot;, to_field=&quot;id&quot;, null=True, blank=True, on_delete=models.SET_NULL)</span>

    <span class="token comment"># 在django中做的约束</span>
    gender_choices <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    gender <span class="token operator">=</span> models<span class="token punctuation">.</span>SmallIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;性别&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>gender_choices<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-在mysql中生成表" tabindex="-1"><a class="header-anchor" href="#_4-在mysql中生成表"><span>4.在MySQL中生成表</span></a></h2><ul><li><p>工具连接MySQL生成数据库。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>create database gx_day16 DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改配置文件，连接MySQL</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,
        &#39;NAME&#39;: &#39;gx_day16&#39;,  # 数据库名字
        &#39;USER&#39;: &#39;root&#39;,
        &#39;PASSWORD&#39;: &#39;root123&#39;,
        &#39;HOST&#39;: &#39;127.0.0.1&#39;,  # 那台机器安装了MySQL
        &#39;PORT&#39;: 3306,
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20211125093556582](day18 Django开发.assets/image-20211125093556582.png)</p></li><li><p>django命令生成数据库表</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>python manage.py makemigrations
python manage.py migrate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20211125093805549](day18 Django开发.assets/image-20211125093805549.png)</p></li></ul><p>表结构创建成功：</p><p>![image-20211125093859327](day18 Django开发.assets/image-20211125093859327.png)</p><h2 id="_5-静态文件管理" tabindex="-1"><a class="header-anchor" href="#_5-静态文件管理"><span>5.静态文件管理</span></a></h2><p>static目录</p><p>![image-20211125095750076](day18 Django开发.assets/image-20211125095750076.png)</p><h2 id="_6-部门管理" tabindex="-1"><a class="header-anchor" href="#_6-部门管理"><span>6.部门管理</span></a></h2><blockquote><p>体验，最原始方法来做。</p><p>Django中提供Form和ModelForm组件（方便）</p></blockquote><p>![image-20211125100519237](day18 Django开发.assets/image-20211125100519237.png)</p><h2 id="_7-模板的继承" tabindex="-1"><a class="header-anchor" href="#_7-模板的继承"><span>7.模板的继承</span></a></h2><ul><li>部门列表</li><li>添加部门</li><li>编辑部门</li></ul><p>定义目版：<code>layout.html</code></p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% static &#39;plugin...min.css&#39; %}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% block css %}{% endblock %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        {% block content %}{% endblock %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% static &#39;js/jquery-3.6.0.min.js&#39; %}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    {% block js %}{% endblock %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继承母版：</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>{% extends &#39;layout.html&#39; %}

{% block css %}
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% static &#39;pluxxx.css&#39; %}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
		...
	</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
{% endblock %}


{% block content %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
{% endblock %}


{% block js %}
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% static &#39;js/jqxxxin.js&#39; %}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-用户管理" tabindex="-1"><a class="header-anchor" href="#_8-用户管理"><span>8.用户管理</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> app01_userinfo<span class="token punctuation">(</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>age<span class="token punctuation">,</span>account<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>depart_id<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&quot;韩超&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;666&quot;</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">100.68</span><span class="token punctuation">,</span><span class="token string">&quot;2020-01-11&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> app01_userinfo<span class="token punctuation">(</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>age<span class="token punctuation">,</span>account<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>depart_id<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&quot;刘东&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">100.68</span><span class="token punctuation">,</span><span class="token string">&quot;2010-11-11&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> app01_userinfo<span class="token punctuation">(</span>name<span class="token punctuation">,</span>password<span class="token punctuation">,</span>age<span class="token punctuation">,</span>account<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>depart_id<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&quot;朱虎飞&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">9900.68</span><span class="token punctuation">,</span><span class="token string">&quot;2021-05-11&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| id          | bigint(20)    | NO   | PRI | NULL    | auto_increment |
| name        | varchar(16)   | NO   |     | NULL    |                |
| password    | varchar(64)   | NO   |     | NULL    |                |
| age         | int(11)       | NO   |     | NULL    |                |
| account     | decimal(10,2) | NO   |     | NULL    |                |
| create_time | datetime(6)   | NO   |     | NULL    |                |
| gender      | smallint(6)   | NO   |     | NULL    |                |
| depart_id   | bigint(20)    | NO   | MUL | NULL    |                |
+-------------+---------------+------+-----+---------+----------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20211125144436879](day18 Django开发.assets/image-20211125144436879.png)</p><p>新建用户：</p><ul><li><p>原始方式理思路：不会采用（本质）【麻烦】</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>- 用户提交数据没有校验。
- 错误，页面上应该有错误提示。
- 页面上，没一个字段都需要我们重新写一遍。     [OK]
- 关联的数据，手动去获取并展示循环展示在页面。  [OK]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Django组件</p><ul><li>Form组件（小简便）</li><li>ModelForm组件（最简便）</li></ul></li></ul><h3 id="_8-1-初识form" tabindex="-1"><a class="header-anchor" href="#_8-1-初识form"><span>8.1 初识Form</span></a></h3><h4 id="_1-views-py" tabindex="-1"><a class="header-anchor" href="#_1-views-py"><span>1. views.py</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    email <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    account <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    create_time <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    depart <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
    gender <span class="token operator">=</span> form<span class="token punctuation">.</span>CharFiled<span class="token punctuation">(</span>widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">user_add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> MyForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;user_add.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;form&quot;</span><span class="token punctuation">:</span>form<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-user-add-html" tabindex="-1"><a class="header-anchor" href="#_2-user-add-html"><span>2.user_add.html</span></a></h4><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% for field in form%}
    	{{ field }}
    {% endfor %}
    <span class="token comment">&lt;!-- &lt;input type=&quot;text&quot;  placeholder=&quot;姓名&quot; name=&quot;user&quot; /&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ form.user }}
    {{ form.pwd }}
    {{ form.email }}
    <span class="token comment">&lt;!-- &lt;input type=&quot;text&quot;  placeholder=&quot;姓名&quot; name=&quot;user&quot; /&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-modelform-推荐" tabindex="-1"><a class="header-anchor" href="#_8-3-modelform-推荐"><span>8.3 ModelForm（推荐）</span></a></h3><h4 id="_0-models-py" tabindex="-1"><a class="header-anchor" href="#_0-models-py"><span>0. models.py</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 员工表 &quot;&quot;&quot;</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;姓名&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;年龄&quot;</span><span class="token punctuation">)</span>
    account <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;账户余额&quot;</span><span class="token punctuation">,</span> max_digits<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;入职时间&quot;</span><span class="token punctuation">)</span>
    depart <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&quot;Department&quot;</span><span class="token punctuation">,</span> to_field<span class="token operator">=</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    gender_choices <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    gender <span class="token operator">=</span> models<span class="token punctuation">.</span>SmallIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;性别&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>gender_choices<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-views-py-1" tabindex="-1"><a class="header-anchor" href="#_1-views-py-1"><span>1. views.py</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xx <span class="token operator">=</span> form<span class="token punctuation">.</span>CharField<span class="token operator">*</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;xx&quot;</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">user_add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> MyForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;user_add.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;form&quot;</span><span class="token punctuation">:</span>form<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-user-add-html-1" tabindex="-1"><a class="header-anchor" href="#_2-user-add-html-1"><span>2.user_add.html</span></a></h4><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% for field in form%}
    	{{ field }}
    {% endfor %}
    <span class="token comment">&lt;!-- &lt;input type=&quot;text&quot;  placeholder=&quot;姓名&quot; name=&quot;user&quot; /&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ form.user }}
    {{ form.pwd }}
    {{ form.email }}
    <span class="token comment">&lt;!-- &lt;input type=&quot;text&quot;  placeholder=&quot;姓名&quot; name=&quot;user&quot; /&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="day17-django开发" tabindex="-1"><a class="header-anchor" href="#day17-django开发"><span>day17 Django开发</span></a></h1><ul><li><p>部门管理</p></li><li><p>用户管理</p><ul><li><p>用户列表</p></li><li><p>新建用户</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>- ModelForm，针对数据库中的某个表。
- Form。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="_8-4-编辑用户" tabindex="-1"><a class="header-anchor" href="#_8-4-编辑用户"><span>8.4 编辑用户</span></a></h3><ul><li><p>点击编辑，跳转到编辑页面（将编辑行的ID携带过去）。</p></li><li><p>编辑页面（默认数据，根据ID获取并设置到页面中）</p></li><li><p>提交：</p><ul><li><p>错误提示</p></li><li><p>数据校验</p></li><li><p>在数据库更新</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>models.UserInfo.filter(id=4).update(...)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="_8-5-删除" tabindex="-1"><a class="header-anchor" href="#_8-5-删除"><span>8.5 删除</span></a></h3><p>见代码。</p><h2 id="_9-靓号管理" tabindex="-1"><a class="header-anchor" href="#_9-靓号管理"><span>9.靓号管理</span></a></h2><h3 id="_9-1-表结构" tabindex="-1"><a class="header-anchor" href="#_9-1-表结构"><span>9.1 表结构</span></a></h3><p>![image-20211126094318872](day18 Django开发.assets/image-20211126094318872.png)</p><p>根据表结构的需求，在models.py中创建类（由类生成数据库中的表）。</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PrettyNum</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 靓号表 &quot;&quot;&quot;</span>
    mobile <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span>
    <span class="token comment"># 想要允许为空 null=True, blank=True</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;价格&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    level_choices <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1级&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;2级&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;3级&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;4级&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    level <span class="token operator">=</span> models<span class="token punctuation">.</span>SmallIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;级别&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>level_choices<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    status_choices <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;已占用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;未使用&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    status <span class="token operator">=</span> models<span class="token punctuation">.</span>SmallIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;状态&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>status_choices<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自己在数据模拟创建一些数据：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> app01_prettynum<span class="token punctuation">(</span>mobile<span class="token punctuation">,</span>price<span class="token punctuation">,</span><span class="token keyword">level</span><span class="token punctuation">,</span><span class="token keyword">status</span><span class="token punctuation">)</span><span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&quot;111111111&quot;</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mysql&gt; select * from app01_prettynum;
+----+-----------+-------+-------+--------+
| id | mobile    | price | level | status |
+----+-----------+-------+-------+--------+
|  1 | 111111111 |    19 |     1 |      1 |
|  2 | 111111111 |    19 |     1 |      1 |
|  3 | 111111111 |    19 |     1 |      1 |
|  4 | 111111111 |    19 |     1 |      1 |
+----+-----------+-------+-------+--------+
4 rows in set (0.01 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-靓号列表" tabindex="-1"><a class="header-anchor" href="#_9-2-靓号列表"><span>9.2 靓号列表</span></a></h3><ul><li><p>URL</p></li><li><p>函数</p><ul><li><p>获取所有的靓号</p></li><li><p>结合html+render将靓号罗列出来</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>id	号码	价格	级别（中文）	状态（中文）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="_9-3-新建靓号" tabindex="-1"><a class="header-anchor" href="#_9-3-新建靓号"><span>9.3 新建靓号</span></a></h3><ul><li><p>列表点击跳转：<code>/pretty/add/</code></p></li><li><p>URL</p></li><li><p>ModelForm类</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>from django import forms

class PrettyModelForm(forms.ModelForm):
	...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>函数</p><ul><li>实例化类的对象</li><li>通过render将对象传入到HTML中。</li><li>模板的循环展示所有的字段。</li></ul></li><li><p>点击提交</p><ul><li>数据校验</li><li>保存到数据库</li><li>跳转回靓号列表</li></ul></li></ul><p>![image-20211126111252278](day18 Django开发.assets/image-20211126111252278.png)</p><h3 id="_9-4-编辑靓号" tabindex="-1"><a class="header-anchor" href="#_9-4-编辑靓号"><span>9.4 编辑靓号</span></a></h3><ul><li>列表页面：<code>/pretty/数字/edit/</code></li><li>URL</li><li>函数 <ul><li>根据ID获取当前编辑的对象</li><li>ModelForm配合，默认显示数据。</li><li>提交修改。</li></ul></li></ul><p>![image-20211126112848435](day18 Django开发.assets/image-20211126112848435.png)</p><p>不允许手机号重复。</p><ul><li><p>添加：【正则表达式】【手机号不能存在】</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment"># [obj,obj,obj]</span>
queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;1888888888&quot;</span><span class="token punctuation">)</span>

obj <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;1888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># True/False</span>
exists <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;1888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编辑：【正则表达式】【手机号不能存在】</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>排除自己以外，其他的数据是否手机号是否重复？

<span class="token comment"># id!=2 and mobile=&#39;1888888888&#39;</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;1888888888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_9-5-搜索手机号" tabindex="-1"><a class="header-anchor" href="#_9-5-搜索手机号"><span>9.5 搜索手机号</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;19999999991&quot;</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

data_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;19999999991&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">}</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>data_dict<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>       <span class="token comment"># 等于12</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__gt<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>   <span class="token comment"># 大于12</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__gte<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>  <span class="token comment"># 大于等于12</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__lt<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>   <span class="token comment"># 小于12</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__lte<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>  <span class="token comment"># 小于等于12</span>

data_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;id__lte&quot;</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">}</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>data_dict<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">)</span>               <span class="token comment"># 等于</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile__startswith<span class="token operator">=</span><span class="token string">&quot;1999&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 筛选出以1999开头</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile__endswith<span class="token operator">=</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">)</span>     <span class="token comment"># 筛选出以999结尾</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile__contains<span class="token operator">=</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">)</span>     <span class="token comment"># 筛选出包含999</span>

data_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;mobile__contains&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">}</span>
models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>data_dict<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-6-分页" tabindex="-1"><a class="header-anchor" href="#_9-6-分页"><span>9.6 分页</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>


<span class="token comment"># 第1页</span>
queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>

<span class="token comment"># 第2页</span>
queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>

<span class="token comment"># 第3页</span>
queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>data <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> models<span class="token punctuation">.</span>PrettyNum<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>分页的逻辑和处理规则</p></li><li><p>封装分页类</p><ul><li>从头到尾开发</li><li>写项目用【pagination.py】公共组件。</li></ul></li><li><p>小Bug，搜索 + 分页情况下。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>分页时候，保留原来的搜索条件

http://127.0.0.1:8000/pretty/list/?q=888
http://127.0.0.1:8000/pretty/list/?page=1

http://127.0.0.1:8000/pretty/list/?q=888&amp;page=23
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="_10-时间插件" tabindex="-1"><a class="header-anchor" href="#_10-时间插件"><span>10.时间插件</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;static/plugins/bootstrap-3.4.1/css/bootstrap.css&quot;&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;static/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css&quot;&gt;


&lt;input type=&quot;text&quot; id=&quot;dt&quot; class=&quot;form-control&quot; placeholder=&quot;入职日期&quot;&gt;



&lt;script src=&quot;static/js/jquery-3.6.0.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;static/plugins/bootstrap-3.4.1/js/bootstrap.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;static/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;static/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js&quot;&gt;&lt;/script&gt;


&lt;script&gt;
    $(function () {
        $(&#39;#dt&#39;).datepicker({
            format: &#39;yyyy-mm-dd&#39;,
            startDate: &#39;0&#39;,
            language: &quot;zh-CN&quot;,
            autoclose: true
        });

    })
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-modelform和bootstrap" tabindex="-1"><a class="header-anchor" href="#_11-modelform和bootstrap"><span>11.ModelForm和BootStrap</span></a></h2><ul><li><p>ModelForm可以帮助我们生成HTML标签。</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

form <span class="token operator">=</span> UserModelForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>{{form.name}}      普通的input框
{{form.password}}  普通的input框
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>定义插件</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>
<span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>{{form.name}}      BootStrap的input框
{{form.password}}  BootStrap的input框
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新定义的init方法，批量设置</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
        <span class="token comment"># 循环ModelForm中的所有字段，给每个字段的插件设置</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">:</span> field<span class="token punctuation">.</span>label
            <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
        <span class="token comment"># 循环ModelForm中的所有字段，给每个字段的插件设置</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 字段中有属性，保留原来的属性，没有属性，才增加。</span>
            <span class="token keyword">if</span> field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">:</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;form-control&quot;</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">.</span>label
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">,</span> 
                    <span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">:</span> field<span class="token punctuation">.</span>label
                <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserEditModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
        <span class="token comment"># 循环ModelForm中的所有字段，给每个字段的插件设置</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 字段中有属性，保留原来的属性，没有属性，才增加。</span>
            <span class="token keyword">if</span> field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">:</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;form-control&quot;</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">.</span>label
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">,</span> 
                    <span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">:</span> field<span class="token punctuation">.</span>label
                <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>自定义类</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BootStrapModelForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token comment"># 循环ModelForm中的所有字段，给每个字段的插件设置</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 字段中有属性，保留原来的属性，没有属性，才增加。</span>
            <span class="token keyword">if</span> field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">:</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;form-control&quot;</span>
				field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">.</span>label
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                field<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">,</span> 
                    <span class="token string">&quot;placeholder&quot;</span><span class="token punctuation">:</span> field<span class="token punctuation">.</span>label
                <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserEditModelForm</span><span class="token punctuation">(</span>BootStrapModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h3><ul><li><p>提取公共的类</p><p>![image-20211126175803303](day18 Django开发.assets/image-20211126175803303.png) ![image-20211126175826579](day18 Django开发.assets/image-20211126175826579.png)</p></li><li><p>ModelForm拆分出来 ![image-20211126175852716](day18 Django开发.assets/image-20211126175852716.png)</p></li><li><p>视图函数的归类 ![image-20211126175927378](day18 Django开发.assets/image-20211126175927378.png)</p><p>![image-20211126175946996](day18 Django开发.assets/image-20211126175946996.png)</p><h1 id="day18-django开发" tabindex="-1"><a class="header-anchor" href="#day18-django开发"><span>day18 Django开发</span></a></h1></li></ul><h1 id="day18" tabindex="-1"><a class="header-anchor" href="#day18"><span>day18</span></a></h1><h2 id="管理员操作" tabindex="-1"><a class="header-anchor" href="#管理员操作"><span>管理员操作</span></a></h2><p>![image-20211127083552755](day18 Django开发.assets/image-20211127083552755.png)</p><h2 id="_13-用户登录" tabindex="-1"><a class="header-anchor" href="#_13-用户登录"><span>13. 用户登录</span></a></h2><p>http无状态短连接：</p><p>![image-20211127110200983](day18 Django开发.assets/image-20211127110200983.png)</p><p>什么是cookie和session？</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>http://127.0.0.1:8000/admin/list/
https://127.0.0.1:8000/admin/list/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![image-20211127111106780](day18 Django开发.assets/image-20211127111106780.png)</p><h3 id="_13-1-登录" tabindex="-1"><a class="header-anchor" href="#_13-1-登录"><span>13.1 登录</span></a></h3><p>登录成功后：</p><ul><li>cookie，随机字符串</li><li>session，用户信息</li></ul><p>在其他需要登录才能访问的页面中，都需要加入：</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    info <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> info<span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目标：在18个视图函数前面统一加入判断。</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>info <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> info<span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-2-中间件的体验" tabindex="-1"><a class="header-anchor" href="#_13-2-中间件的体验"><span>13.2 中间件的体验</span></a></h3><p>![image-20211127142838372](day18 Django开发.assets/image-20211127142838372.png)</p><ul><li><p>定义中间件</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>deprecation <span class="token keyword">import</span> MiddlewareMixin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> HttpResponse

<span class="token keyword">class</span> <span class="token class-name">M1</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 中间件1 &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># 如果方法中没有返回值（返回None），继续向后走</span>
        <span class="token comment"># 如果有返回值 HttpResponse、render 、redirect</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;M1.process_request&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;无权访问&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;M1.process_response&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response


<span class="token keyword">class</span> <span class="token class-name">M2</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 中间件2 &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;M2.process_request&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;M2.process_response&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>应用中间件 setings.py</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;app01.middleware.auth.M1&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;app01.middleware.auth.M2&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在中间件的process_request方法</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment"># 如果方法中没有返回值（返回None），继续向后走</span>
<span class="token comment"># 如果有返回值 HttpResponse、render 、redirect，则不再继续向后执行。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_13-3-中间件实现登录校验" tabindex="-1"><a class="header-anchor" href="#_13-3-中间件实现登录校验"><span>13.3 中间件实现登录校验</span></a></h3><ul><li><p>编写中间件</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>deprecation <span class="token keyword">import</span> MiddlewareMixin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> HttpResponse<span class="token punctuation">,</span> redirect


<span class="token keyword">class</span> <span class="token class-name">AuthMiddleware</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 0.排除那些不需要登录就能访问的页面</span>
        <span class="token comment">#   request.path_info 获取当前用户请求的URL /login/</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>path_info <span class="token operator">==</span> <span class="token string">&quot;/login/&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        <span class="token comment"># 1.读取当前访问的用户的session信息，如果能读到，说明已登陆过，就可以继续向后走。</span>
        info_dict <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>info_dict<span class="token punctuation">)</span>
        <span class="token keyword">if</span> info_dict<span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        <span class="token comment"># 2.没有登录过，重新回到登录页面</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>应用中间件</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;app01.middleware.auth.AuthMiddleware&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_13-4-注销" tabindex="-1"><a class="header-anchor" href="#_13-4-注销"><span>13.4 注销</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 注销 &quot;&quot;&quot;</span>

    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-5-当前用户" tabindex="-1"><a class="header-anchor" href="#_13-5-当前用户"><span>13.5 当前用户</span></a></h3><p>![image-20211127152144792](day18 Django开发.assets/image-20211127152144792.png)</p><h2 id="_14-图片验证码" tabindex="-1"><a class="header-anchor" href="#_14-图片验证码"><span>14.图片验证码</span></a></h2><img src="`+p+`" alt="image-20211127152344329" style="zoom:50%;"><h3 id="_14-1-生成图片" tabindex="-1"><a class="header-anchor" href="#_14-1-生成图片"><span>14.1 生成图片</span></a></h3><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>pip install pillow
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">import</span> random
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont<span class="token punctuation">,</span> ImageFilter


<span class="token keyword">def</span> <span class="token function">check_code</span><span class="token punctuation">(</span>width<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> char_length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> font_file<span class="token operator">=</span><span class="token string">&#39;Monaco.ttf&#39;</span><span class="token punctuation">,</span> font_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rndChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        生成随机字母
        :return:
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rndColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        生成随机颜色
        :return:
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 写文字</span>
    font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span>font_file<span class="token punctuation">,</span> font_size<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>char_length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        char <span class="token operator">=</span> rndChar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        code<span class="token punctuation">.</span>append<span class="token punctuation">(</span>char<span class="token punctuation">)</span>
        h <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
        draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token operator">*</span> width <span class="token operator">/</span> char_length<span class="token punctuation">,</span> h<span class="token punctuation">]</span><span class="token punctuation">,</span> char<span class="token punctuation">,</span> font<span class="token operator">=</span>font<span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 写干扰点</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        draw<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 写干扰圆圈</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        draw<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
        y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span>
        draw<span class="token punctuation">.</span>arc<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 画干扰线</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
        y1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
        y2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span>

        draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    img <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>EDGE_ENHANCE_MORE<span class="token punctuation">)</span>
    <span class="token keyword">return</span> img<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>code<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    img<span class="token punctuation">,</span> code_str <span class="token operator">=</span> check_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;code.png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-ajax请求" tabindex="-1"><a class="header-anchor" href="#_15-ajax请求"><span>15. Ajax请求</span></a></h2><p>浏览器向网站发送请求时：URL 和 表单的形式提交。</p><ul><li>GET</li><li>POST</li></ul><p>特点：页面刷新。</p><p>除此之外，也可以基于Ajax向后台发送请求（偷偷的发送请求）。</p><ul><li><p>依赖jQuery</p></li><li><p>编写ajax代码</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">&quot;发送的地址&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">n1</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">,</span>
        <span class="token literal-property property">n2</span><span class="token operator">:</span><span class="token number">456</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_15-1-get请求" tabindex="-1"><a class="header-anchor" href="#_15-1-get请求"><span>15.1 GET请求</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;/task/ajax/&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">n1</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
        <span class="token literal-property property">n2</span><span class="token operator">:</span> <span class="token number">456</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> HttpResponse

<span class="token keyword">def</span> <span class="token function">task_ajax</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;成功了&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-2-post请求" tabindex="-1"><a class="header-anchor" href="#_15-2-post请求"><span>15.2 POST请求</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;/task/ajax/&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">n1</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
        <span class="token literal-property property">n2</span><span class="token operator">:</span> <span class="token number">456</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt


<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">task_ajax</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;成功了&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-3-关闭绑定事件" tabindex="-1"><a class="header-anchor" href="#_15-3-关闭绑定事件"><span>15.3 关闭绑定事件</span></a></h3><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>{% extends &#39;layout.html&#39; %}


{% block content %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>任务管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>示例1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>点击<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{% endblock %}

{% block js %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 页面框架加载完成之后代码自动执行</span>
            <span class="token function">bindBtn1Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">bindBtn1Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;/task/ajax/&#39;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">n1</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">n2</span><span class="token operator">:</span> <span class="token number">456</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-4-ajax请求的返回值" tabindex="-1"><a class="header-anchor" href="#_15-4-ajax请求的返回值"><span>15.4 ajax请求的返回值</span></a></h3><p>一般都会返回JSON格式。</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>{% extends &#39;layout.html&#39; %}


{% block content %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>任务管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>示例1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>点击<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{% endblock %}

{% block js %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 页面框架加载完成之后代码自动执行</span>
            <span class="token function">bindBtn1Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">bindBtn1Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;/task/ajax/&#39;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">n1</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">n2</span><span class="token operator">:</span> <span class="token number">456</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;JSON&quot;</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> JsonResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt


<span class="token keyword">def</span> <span class="token function">task_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 任务列表 &quot;&quot;&quot;</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;task_list.html&quot;</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">task_ajax</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>

    data_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,138),l=[o];function c(i,u){return s(),a("div",null,l)}const k=n(e,[["render",c],["__file","day16~18 Django开发.html.vue"]]),m=JSON.parse('{"path":"/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/04.%20Project/Platform/Web/04.%20%E5%90%8E%E7%AB%AF/04.%20Py-Django/B%E7%AB%99%E6%AD%A6%E6%B2%9B%E9%BD%90/day16~18%20Django%E5%BC%80%E5%8F%91.html","title":"Django","lang":"zh-CN","frontmatter":{"description":"Django 目录 day16 Django开发 主题：员工管理系统 1.新建项目 ![image-20211125083543235](day18 Django开发.assets/image-20211125083543235.png) ![image-20211125083701911](day18 Django开发.assets/image-20...","head":[["meta",{"property":"og:url","content":"http://192.168.0.101:8080/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/04.%20Project/Platform/Web/04.%20%E5%90%8E%E7%AB%AF/04.%20Py-Django/B%E7%AB%99%E6%AD%A6%E6%B2%9B%E9%BD%90/day16~18%20Django%E5%BC%80%E5%8F%91.html"}],["meta",{"property":"og:site_name","content":"Linc 的小站"}],["meta",{"property":"og:title","content":"Django"}],["meta",{"property":"og:description","content":"Django 目录 day16 Django开发 主题：员工管理系统 1.新建项目 ![image-20211125083543235](day18 Django开发.assets/image-20211125083543235.png) ![image-20211125083701911](day18 Django开发.assets/image-20..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"LincZero"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Django\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\",\\"url\\":\\"https://github.com/LincZero/\\"}]}"]]},"headers":[{"level":1,"title":"Django","slug":"django","link":"#django","children":[]},{"level":1,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":1,"title":"day16 Django开发","slug":"day16-django开发","link":"#day16-django开发","children":[{"level":2,"title":"1.新建项目","slug":"_1-新建项目","link":"#_1-新建项目","children":[]},{"level":2,"title":"2.创建app","slug":"_2-创建app","link":"#_2-创建app","children":[]},{"level":2,"title":"3.设计表结构（django）","slug":"_3-设计表结构-django","link":"#_3-设计表结构-django","children":[]},{"level":2,"title":"4.在MySQL中生成表","slug":"_4-在mysql中生成表","link":"#_4-在mysql中生成表","children":[]},{"level":2,"title":"5.静态文件管理","slug":"_5-静态文件管理","link":"#_5-静态文件管理","children":[]},{"level":2,"title":"6.部门管理","slug":"_6-部门管理","link":"#_6-部门管理","children":[]},{"level":2,"title":"7.模板的继承","slug":"_7-模板的继承","link":"#_7-模板的继承","children":[]},{"level":2,"title":"8.用户管理","slug":"_8-用户管理","link":"#_8-用户管理","children":[{"level":3,"title":"8.1 初识Form","slug":"_8-1-初识form","link":"#_8-1-初识form","children":[{"level":4,"title":"1. views.py","slug":"_1-views-py","link":"#_1-views-py","children":[]},{"level":4,"title":"2.user_add.html","slug":"_2-user-add-html","link":"#_2-user-add-html","children":[]}]},{"level":3,"title":"8.3 ModelForm（推荐）","slug":"_8-3-modelform-推荐","link":"#_8-3-modelform-推荐","children":[{"level":4,"title":"0. models.py","slug":"_0-models-py","link":"#_0-models-py","children":[]},{"level":4,"title":"1. views.py","slug":"_1-views-py-1","link":"#_1-views-py-1","children":[]},{"level":4,"title":"2.user_add.html","slug":"_2-user-add-html-1","link":"#_2-user-add-html-1","children":[]}]}]}]},{"level":1,"title":"day17 Django开发","slug":"day17-django开发","link":"#day17-django开发","children":[{"level":3,"title":"8.4 编辑用户","slug":"_8-4-编辑用户","link":"#_8-4-编辑用户","children":[]},{"level":3,"title":"8.5 删除","slug":"_8-5-删除","link":"#_8-5-删除","children":[]},{"level":2,"title":"9.靓号管理","slug":"_9-靓号管理","link":"#_9-靓号管理","children":[{"level":3,"title":"9.1 表结构","slug":"_9-1-表结构","link":"#_9-1-表结构","children":[]},{"level":3,"title":"9.2 靓号列表","slug":"_9-2-靓号列表","link":"#_9-2-靓号列表","children":[]},{"level":3,"title":"9.3 新建靓号","slug":"_9-3-新建靓号","link":"#_9-3-新建靓号","children":[]},{"level":3,"title":"9.4 编辑靓号","slug":"_9-4-编辑靓号","link":"#_9-4-编辑靓号","children":[]},{"level":3,"title":"9.5 搜索手机号","slug":"_9-5-搜索手机号","link":"#_9-5-搜索手机号","children":[]},{"level":3,"title":"9.6 分页","slug":"_9-6-分页","link":"#_9-6-分页","children":[]}]},{"level":2,"title":"10.时间插件","slug":"_10-时间插件","link":"#_10-时间插件","children":[]},{"level":2,"title":"11.ModelForm和BootStrap","slug":"_11-modelform和bootstrap","link":"#_11-modelform和bootstrap","children":[{"level":3,"title":"操作","slug":"操作","link":"#操作","children":[]}]}]},{"level":1,"title":"day18","slug":"day18","link":"#day18","children":[{"level":2,"title":"管理员操作","slug":"管理员操作","link":"#管理员操作","children":[]},{"level":2,"title":"13. 用户登录","slug":"_13-用户登录","link":"#_13-用户登录","children":[{"level":3,"title":"13.1 登录","slug":"_13-1-登录","link":"#_13-1-登录","children":[]},{"level":3,"title":"13.2 中间件的体验","slug":"_13-2-中间件的体验","link":"#_13-2-中间件的体验","children":[]},{"level":3,"title":"13.3 中间件实现登录校验","slug":"_13-3-中间件实现登录校验","link":"#_13-3-中间件实现登录校验","children":[]},{"level":3,"title":"13.4 注销","slug":"_13-4-注销","link":"#_13-4-注销","children":[]},{"level":3,"title":"13.5 当前用户","slug":"_13-5-当前用户","link":"#_13-5-当前用户","children":[]}]},{"level":2,"title":"14.图片验证码","slug":"_14-图片验证码","link":"#_14-图片验证码","children":[{"level":3,"title":"14.1 生成图片","slug":"_14-1-生成图片","link":"#_14-1-生成图片","children":[]}]},{"level":2,"title":"15. Ajax请求","slug":"_15-ajax请求","link":"#_15-ajax请求","children":[{"level":3,"title":"15.1 GET请求","slug":"_15-1-get请求","link":"#_15-1-get请求","children":[]},{"level":3,"title":"15.2 POST请求","slug":"_15-2-post请求","link":"#_15-2-post请求","children":[]},{"level":3,"title":"15.3 关闭绑定事件","slug":"_15-3-关闭绑定事件","link":"#_15-3-关闭绑定事件","children":[]},{"level":3,"title":"15.4 ajax请求的返回值","slug":"_15-4-ajax请求的返回值","link":"#_15-4-ajax请求的返回值","children":[]}]}]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":11.28,"words":3383},"filePathRelative":"MdNote_Public/01. 设计开发与数据生产/Develop/04. Project/Platform/Web/04. 后端/04. Py-Django/B站武沛齐/day16~18 Django开发.md","autoDesc":true}');export{k as comp,m as data};
