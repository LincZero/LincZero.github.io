import{H as kt,g as vt,d as _t,a as bt,w as M,n as X}from"./index-BQNXaplB.js";import{l as Oe,b as Te}from"./index-BQNXaplB.js";import{h as S,x as wt,y as $t,i as zt}from"./app-D6xHgHjd.js";class Q extends Map{constructor(t,e=St){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(G(this,t))}has(t){return super.has(G(this,t))}set(t,e){return super.set(Et(this,t),e)}delete(t){return super.delete(Ct(this,t))}}function G({_intern:n,_key:t},e){const i=t(e);return n.has(i)?n.get(i):e}function Et({_intern:n,_key:t},e){const i=t(e);return n.has(i)?n.get(i):(n.set(i,e),e)}function Ct({_intern:n,_key:t},e){const i=t(e);return n.has(i)&&(e=n.get(i),n.delete(i)),e}function St(n){return n!==null&&typeof n=="object"?n.valueOf():n}function J(n,t){let e;if(t===void 0)for(const i of n)i!=null&&(e<i||e===void 0&&i>=i)&&(e=i);else{let i=-1;for(let r of n)(r=t(r,++i,n))!=null&&(e<r||e===void 0&&r>=r)&&(e=r)}return e}function U(n,t){let e;if(t===void 0)for(const i of n)i!=null&&(e>i||e===void 0&&i>=i)&&(e=i);else{let i=-1;for(let r of n)(r=t(r,++i,n))!=null&&(e>r||e===void 0&&r>=r)&&(e=r)}return e}function Mt(n,t){let e,i=-1,r=-1;if(t===void 0)for(const s of n)++r,s!=null&&(e>s||e===void 0&&s>=s)&&(e=s,i=r);else for(let s of n)(s=t(s,++r,n))!=null&&(e>s||e===void 0&&s>=s)&&(e=s,i=r);return i}const B=Math.PI,D=2*B,z=1e-6,Xt=D-z;function it(n){this._+=n[0];for(let t=1,e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function At(n){let t=Math.floor(n);if(!(t>=0))throw new Error(`invalid digits: ${n}`);if(t>15)return it;const e=10**t;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*e)/e+i[r]}}class Rt{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?it:At(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,i,r){this._append`Q${+t},${+e},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,e,i,r,s,h){this._append`C${+t},${+e},${+i},${+r},${this._x1=+s},${this._y1=+h}`}arcTo(t,e,i,r,s){if(t=+t,e=+e,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let h=this._x1,o=this._y1,l=i-t,d=r-e,c=h-t,u=o-e,f=c*c+u*u;if(this._x1===null)this._append`M${this._x1=t},${this._y1=e}`;else if(f>z)if(!(Math.abs(u*l-d*c)>z)||!s)this._append`L${this._x1=t},${this._y1=e}`;else{let g=i-h,m=r-o,x=l*l+d*d,v=g*g+m*m,k=Math.sqrt(x),b=Math.sqrt(f),C=s*Math.tan((B-Math.acos((x+f-v)/(2*k*b)))/2),w=C/b,$=C/k;Math.abs(w-1)>z&&this._append`L${t+w*c},${e+w*u}`,this._append`A${s},${s},0,0,${+(u*g>c*m)},${this._x1=t+$*l},${this._y1=e+$*d}`}}arc(t,e,i,r,s,h){if(t=+t,e=+e,i=+i,h=!!h,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(r),l=i*Math.sin(r),d=t+o,c=e+l,u=1^h,f=h?r-s:s-r;this._x1===null?this._append`M${d},${c}`:(Math.abs(this._x1-d)>z||Math.abs(this._y1-c)>z)&&this._append`L${d},${c}`,i&&(f<0&&(f=f%D+D),f>Xt?this._append`A${i},${i},0,1,${u},${t-o},${e-l}A${i},${i},0,1,${u},${this._x1=d},${this._y1=c}`:f>z&&this._append`A${i},${i},0,${+(f>=B)},${u},${this._x1=t+i*Math.cos(s)},${this._y1=e+i*Math.sin(s)}`)}rect(t,e,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function jt(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}const tt=Symbol("implicit");function L(){var n=new Q,t=[],e=[],i=tt;function r(s){let h=n.get(s);if(h===void 0){if(i!==tt)return i;n.set(s,h=t.push(s)-1)}return e[h%e.length]}return r.domain=function(s){if(!arguments.length)return t.slice();t=[],n=new Q;for(const h of s)n.has(h)||n.set(h,t.push(h)-1);return r},r.range=function(s){return arguments.length?(e=Array.from(s),r):e.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return L(t,e).unknown(i)},jt.apply(r,arguments),r}function Ot(n){for(var t=n.length/6|0,e=new Array(t),i=0;i<t;)e[i]="#"+n.slice(i*6,++i*6);return e}const Tt=Ot("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function et(n){return function(){return n}}function Ht(n){let t=3;return n.digits=function(e){if(!arguments.length)return t;if(e==null)t=null;else{const i=Math.floor(e);if(!(i>=0))throw new RangeError(`invalid digits: ${e}`);t=i}return n},()=>new Rt(t)}var Bt=Array.prototype.slice;function Dt(n){return n[0]}function Lt(n){return n[1]}class Pt{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e);break}}this._x0=t,this._y0=e}}function Wt(n){return new Pt(n,!0)}function Ft(n){return n.source}function Nt(n){return n.target}function It(n){let t=Ft,e=Nt,i=Dt,r=Lt,s=null,h=null,o=Ht(l);function l(){let d;const c=Bt.call(arguments),u=t.apply(this,c),f=e.apply(this,c);if(s==null&&(h=n(d=o())),h.lineStart(),c[0]=u,h.point(+i.apply(this,c),+r.apply(this,c)),c[0]=f,h.point(+i.apply(this,c),+r.apply(this,c)),h.lineEnd(),d)return h=null,d+""||null}return l.source=function(d){return arguments.length?(t=d,l):t},l.target=function(d){return arguments.length?(e=d,l):e},l.x=function(d){return arguments.length?(i=typeof d=="function"?d:et(+d),l):i},l.y=function(d){return arguments.length?(r=typeof d=="function"?d:et(+d),l):r},l.context=function(d){return arguments.length?(d==null?s=h=null:h=n(s=d),l):s},l}function Vt(){return It(Wt)}const rt=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),qt=L(Tt),at=(n=1,t=3,e=2)=>i=>n+t/e**i.state.depth,st={autoFit:!1,duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,scrollForPan:rt,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1,color:n=>{var t;return qt(`${((t=n.state)==null?void 0:t.path)||""}`)},lineWidth:at(),maxWidth:0,nodeMinHeight:16,paddingX:8,spacingHorizontal:80,spacingVertical:5};function Xe(n){const t={},e={...n},{color:i,colorFreezeLevel:r,lineWidth:s}=e;if((i==null?void 0:i.length)===1){const h=i[0];t.color=()=>h}else if(i!=null&&i.length){const h=L(i);t.color=o=>h(`${o.state.path}`)}if(r){const h=t.color||st.color;t.color=o=>(o={...o,state:{...o.state,path:o.state.path.split(".").slice(0,r).join(".")}},h(o))}if(s){const h=Array.isArray(s)?s:[s,0,1];t.lineWidth=at(...h)}return["duration","fitRatio","initialExpandLevel","maxInitialScale","maxWidth","nodeMinHeight","paddingX","spacingHorizontal","spacingVertical"].forEach(h=>{const o=e[h];typeof o=="number"&&(t[h]=o)}),["zoom","pan"].forEach(h=>{const o=e[h];o!=null&&(t[h]=!!o)}),t}function Kt(n){let t=0;for(let e=0;e<n.length;e++)t=(t<<5)-t+n.charCodeAt(e)|0;return(t>>>0).toString(36)}function _(n){if(typeof n=="string"){const e=n;n=i=>i.matches(e)}const t=n;return function(){let e=Array.from(this.childNodes);return t&&(e=e.filter(i=>t(i))),e}}function Zt(n){var t=0,e=n.children,i=e&&e.length;if(!i)t=1;else for(;--i>=0;)t+=e[i].value;n.value=t}function Yt(){return this.eachAfter(Zt)}function Qt(n){var t=this,e,i=[t],r,s,h;do for(e=i.reverse(),i=[];t=e.pop();)if(n(t),r=t.children,r)for(s=0,h=r.length;s<h;++s)i.push(r[s]);while(i.length);return this}function Gt(n){for(var t=this,e=[t],i,r;t=e.pop();)if(n(t),i=t.children,i)for(r=i.length-1;r>=0;--r)e.push(i[r]);return this}function Jt(n){for(var t=this,e=[t],i=[],r,s,h;t=e.pop();)if(i.push(t),r=t.children,r)for(s=0,h=r.length;s<h;++s)e.push(r[s]);for(;t=i.pop();)n(t);return this}function Ut(n){return this.eachAfter(function(t){for(var e=+n(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)e+=i[r].value;t.value=e})}function te(n){return this.eachBefore(function(t){t.children&&t.children.sort(n)})}function ee(n){for(var t=this,e=ne(t,n),i=[t];t!==e;)t=t.parent,i.push(t);for(var r=i.length;n!==e;)i.splice(r,0,n),n=n.parent;return i}function ne(n,t){if(n===t)return n;var e=n.ancestors(),i=t.ancestors(),r=null;for(n=e.pop(),t=i.pop();n===t;)r=n,n=e.pop(),t=i.pop();return r}function ie(){for(var n=this,t=[n];n=n.parent;)t.push(n);return t}function re(){var n=[];return this.each(function(t){n.push(t)}),n}function ae(){var n=[];return this.eachBefore(function(t){t.children||n.push(t)}),n}function se(){var n=this,t=[];return n.each(function(e){e!==n&&t.push({source:e.parent,target:e})}),t}function P(n,t){var e=new A(n),i=+n.value&&(e.value=n.value),r,s=[e],h,o,l,d;for(t==null&&(t=he);r=s.pop();)if(i&&(r.value=+r.data.value),(o=t(r.data))&&(d=o.length))for(r.children=new Array(d),l=d-1;l>=0;--l)s.push(h=r.children[l]=new A(o[l])),h.parent=r,h.depth=r.depth+1;return e.eachBefore(ce)}function oe(){return P(this).eachBefore(le)}function he(n){return n.children}function le(n){n.data=n.data.data}function ce(n){var t=0;do n.height=t;while((n=n.parent)&&n.height<++t)}function A(n){this.data=n,this.depth=this.height=0,this.parent=null}A.prototype=P.prototype={constructor:A,count:Yt,each:Qt,eachAfter:Jt,eachBefore:Gt,sum:Ut,sort:te,path:ee,ancestors:ie,descendants:re,leaves:ae,links:se,copy:oe};const de="2.1.2",ue={version:de},{version:pe}=ue,fe=Object.freeze({children:n=>n.children,nodeSize:n=>n.data.size,spacing:0});function ht(n){const t=Object.assign({},fe,n);function e(o){const l=t[o];return typeof l=="function"?l:()=>l}function i(o){const l=h(s(),o,d=>d.children);return l.update(),l.data}function r(){const o=e("nodeSize"),l=e("spacing");return class ot extends P.prototype.constructor{constructor(c){super(c)}copy(){const c=h(this.constructor,this,u=>u.children);return c.each(u=>u.data=u.data.data),c}get size(){return o(this)}spacing(c){return l(this,c)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const c=this.ancestors();return c[c.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((c,u)=>ot.maxExtents(c,u.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(c,u){return{top:Math.min(c.top,u.top),bottom:Math.max(c.bottom,u.bottom),left:Math.min(c.left,u.left),right:Math.max(c.right,u.right)}}}}function s(){const o=r(),l=e("nodeSize"),d=e("spacing");return class extends o{constructor(c){super(c),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return l(this.data)}spacing(c){return d(this.data,c.data)}get x(){return this.data.x}set x(c){this.data.x=c}get y(){return this.data.y}set y(c){this.data.y=c}update(){return lt(this),ct(this),this}}}function h(o,l,d){const c=(u,f)=>{const g=new o(u);Object.assign(g,{parent:f,depth:f===null?0:f.depth+1,height:0,length:1});const m=d(u)||[];return g.children=m.length===0?null:m.map(x=>c(x,g)),g.children&&Object.assign(g,g.children.reduce((x,v)=>({height:Math.max(x.height,v.height+1),length:x.length+v.length}),g)),g};return c(l,null)}return Object.assign(i,{nodeSize(o){return arguments.length?(t.nodeSize=o,i):t.nodeSize},spacing(o){return arguments.length?(t.spacing=o,i):t.spacing},children(o){return arguments.length?(t.children=o,i):t.children},hierarchy(o,l){const d=typeof l>"u"?t.children:l;return h(r(),o,d)},dump(o){const l=e("nodeSize"),d=c=>u=>{const f=c+"  ",g=c+"    ",{x:m,y:x}=u,v=l(u),k=u.children||[],b=k.length===0?" ":`,${f}children: [${g}${k.map(d(g)).join(g)}${f}],${c}`;return`{ size: [${v.join(", ")}],${f}x: ${m}, y: ${x}${b}},`};return d(`
`)(o)}}),i}ht.version=pe;const lt=(n,t=0)=>(n.y=t,(n.children||[]).reduce((e,i)=>{const[r,s]=e;lt(i,n.y+n.ySize);const h=(r===0?i.lExt:i.rExt).bottom;r!==0&&me(n,r,s);const o=$e(h,r,s);return[r+1,o]},[0,null]),ge(n),we(n),n),ct=(n,t,e)=>{typeof t>"u"&&(t=-n.relX-n.prelim,e=0);const i=t+n.relX;return n.relX=i+n.prelim-e,n.prelim=0,n.x=e+n.relX,(n.children||[]).forEach(r=>ct(r,i,n.x)),n},ge=n=>{(n.children||[]).reduce((t,e)=>{const[i,r]=t,s=i+e.shift,h=r+s+e.change;return e.relX+=h,[s,h]},[0,0])},me=(n,t,e)=>{const i=n.children[t-1],r=n.children[t];let s=i,h=i.relX,o=r,l=r.relX,d=!0;for(;s&&o;){s.bottom>e.lowY&&(e=e.next);const c=h+s.prelim-(l+o.prelim)+s.xSize/2+o.xSize/2+s.spacing(o);(c>0||c<0&&d)&&(l+=c,xe(r,c),ye(n,t,e.index,c)),d=!1;const u=s.bottom,f=o.bottom;u<=f&&(s=ve(s),s&&(h+=s.relX)),u>=f&&(o=ke(o),o&&(l+=o.relX))}!s&&o?_e(n,t,o,l):s&&!o&&be(n,t,s,h)},xe=(n,t)=>{n.relX+=t,n.lExtRelX+=t,n.rExtRelX+=t},ye=(n,t,e,i)=>{const r=n.children[t],s=t-e;if(s>1){const h=i/s;n.children[e+1].shift+=h,r.shift-=h,r.change-=i-h}},ke=n=>n.hasChildren?n.firstChild:n.lThr,ve=n=>n.hasChildren?n.lastChild:n.rThr,_e=(n,t,e,i)=>{const r=n.firstChild,s=r.lExt,h=n.children[t];s.lThr=e;const o=i-e.relX-r.lExtRelX;s.relX+=o,s.prelim-=o,r.lExt=h.lExt,r.lExtRelX=h.lExtRelX},be=(n,t,e,i)=>{const r=n.children[t],s=r.rExt,h=n.children[t-1];s.rThr=e;const o=i-e.relX-r.rExtRelX;s.relX+=o,s.prelim-=o,r.rExt=h.rExt,r.rExtRelX=h.rExtRelX},we=n=>{if(n.hasChildren){const t=n.firstChild,e=n.lastChild,i=(t.prelim+t.relX-t.xSize/2+e.relX+e.prelim+e.xSize/2)/2;Object.assign(n,{prelim:i,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:e.rExt,rExtRelX:e.rExtRelX})}},$e=(n,t,e)=>{for(;e!==null&&n>=e.lowY;)e=e.next;return{lowY:n,index:t,next:e}},dt=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",Ae=dt,O="g.markmap-node",ze="path.markmap-link",Ee="g.markmap-highlight",T=Vt();function nt(n,t){const e=Mt(n,t);return n[e]}function H(n){n.stopPropagation()}const Ce=new kt;class ut{constructor(t,e){this.options={...st},this._disposeList=[],this.handleZoom=i=>{const{transform:r}=i;this.g.attr("transform",r)},this.handlePan=i=>{i.preventDefault();const r=S(this.svg.node()),s=r.translate(-i.deltaX/r.k,-i.deltaY/r.k);this.svg.call(this.zoom.transform,s)},this.handleClick=(i,r)=>{let s=this.options.toggleRecursively;(rt?i.metaKey:i.ctrlKey)&&(s=!s),this.toggleNode(r,s)},this.ensureView=this.ensureVisible,this.svg=t.datum?t:wt(t),this.styleNode=this.svg.append("style"),this.zoom=$t().filter(i=>this.options.scrollForPan&&i.type==="wheel"?i.ctrlKey&&!i.button:(!i.ctrlKey||i.type==="wheel")&&!i.button).on("zoom",this.handleZoom),this.setOptions(e),this.state={id:this.options.id||this.svg.attr("id")||vt(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(_t(()=>{this.renderData()},100)),this._disposeList.push(Ce.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:t}=this.options,{id:e}=this.state,i=typeof t=="function"?t(e):"";return[this.options.embedGlobalCSS&&dt,i].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",bt(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}async toggleNode(t,e=!1){var i,r;const s=(i=t.payload)!=null&&i.fold?0:1;e?M(t,(h,o)=>{h.payload={...h.payload,fold:s},o()}):t.payload={...t.payload,fold:(r=t.payload)!=null&&r.fold?0:1},await this.renderData(t)}_initializeData(t){let e=0;const{color:i,initialExpandLevel:r}=this.options;let s=0,h=0;return M(t,(o,l,d)=>{var c,u,f,g;h+=1,o.children=(c=o.children)==null?void 0:c.map(x=>({...x})),e+=1,o.state={...o.state,depth:h,id:e,rect:{x:0,y:0,width:0,height:0},size:[0,0]},o.state.key=[(u=d==null?void 0:d.state)==null?void 0:u.id,o.state.id].filter(Boolean).join(".")+Kt(o.content),o.state.path=[(f=d==null?void 0:d.state)==null?void 0:f.path,o.state.id].filter(Boolean).join("."),i(o);const m=((g=o.payload)==null?void 0:g.fold)===2;m?s+=1:(s||r>=0&&o.state.depth>=r)&&(o.payload={...o.payload,fold:1}),l(),m&&(s-=1),h-=1}),t}_relayout(){if(!this.state.data)return;this.g.selectAll(_(O)).selectAll(_("foreignObject")).each(function(l){var d;const c=(d=this.firstChild)==null?void 0:d.firstChild,u=[c.scrollWidth,c.scrollHeight];l.state.size=u});const{lineWidth:t,paddingX:e,spacingHorizontal:i,spacingVertical:r}=this.options,s=ht({}).children(l=>{var d;if(!((d=l.payload)!=null&&d.fold))return l.children}).nodeSize(l=>{const[d,c]=l.data.state.size;return[c,d+(d?e*2:0)+i]}).spacing((l,d)=>(l.parent===d.parent?r:r*2)+t(l.data)),h=s.hierarchy(this.state.data);s(h);const o=h.descendants();o.forEach(l=>{const d=l.data;d.state.rect={x:l.y,y:l.x-l.xSize/2,width:l.ySize-i,height:l.xSize}}),this.state.rect={x1:U(o,l=>l.data.state.rect.x)||0,y1:U(o,l=>l.data.state.rect.y)||0,x2:J(o,l=>l.data.state.rect.x+l.data.state.rect.width)||0,y2:J(o,l=>l.data.state.rect.y+l.data.state.rect.height)||0}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(t,e){e&&this.setOptions(e),t&&(this.state.data=this._initializeData(t)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(t){this.state.highlight=t||void 0,await this.renderData()}_getHighlightRect(t){const e=this.svg.node(),i=4/S(e).k,r={...t.state.rect};return r.x-=i,r.y-=i,r.width+=2*i,r.height+=2*i,r}async renderData(t){const{paddingX:e,autoFit:i,color:r,maxWidth:s,lineWidth:h}=this.options,o=this.state.data;if(!o)return;const l={},d={},c=[];M(o,(a,p,y)=>{var E;(E=a.payload)!=null&&E.fold||p(),l[a.state.id]=a,y&&(d[a.state.id]=y.state.id),c.push(a)});const u={},f={},g=a=>{!a||u[a.state.id]||M(a,(p,y)=>{u[p.state.id]=a.state.id,y()})},m=a=>f[u[a.state.id]]||o.state.rect,x=a=>(l[u[a.state.id]]||o).state.rect;f[o.state.id]=o.state.rect,t&&g(t);const{highlight:v}=this.state;let k=this.g.selectAll(_(Ee)).selectAll(_("rect")).data(v?[this._getHighlightRect(v)]:[]).join("rect").attr("x",a=>a.x).attr("y",a=>a.y).attr("width",a=>a.width).attr("height",a=>a.height);const b=this.g.selectAll(_(O)).each(a=>{f[a.state.id]=a.state.rect}).data(c,a=>a.state.key),C=b.enter().append("g").attr("data-depth",a=>a.state.depth).attr("data-path",a=>a.state.path).each(a=>{g(l[d[a.state.id]])}),w=b.exit().each(a=>{g(l[d[a.state.id]])}),$=b.merge(C).attr("class",a=>{var p;return["markmap-node",((p=a.payload)==null?void 0:p.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),W=$.selectAll(_("line")).data(a=>[a],a=>a.state.key),F=W.enter().append("line").attr("stroke",a=>r(a)).attr("stroke-width",0),N=W.merge(F),I=$.selectAll(_("circle")).data(a=>{var p;return(p=a.children)!=null&&p.length?[a]:[]},a=>a.state.key),V=I.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(a,p)=>this.handleClick(a,p)).on("mousedown",H).merge(I).attr("stroke",a=>r(a)).attr("fill",a=>{var p;return(p=a.payload)!=null&&p.fold&&a.children?r(a):"var(--markmap-circle-open-bg)"}),q=this._observer,K=$.selectAll(_("foreignObject")).data(a=>[a],a=>a.state.key),R=K.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",e).attr("y",0).style("opacity",0).on("mousedown",H).on("dblclick",H);R.append("xhtml:div").append("xhtml:div").html(a=>a.content).attr("xmlns","http://www.w3.org/1999/xhtml"),R.each(function(){var a;const p=(a=this.firstChild)==null?void 0:a.firstChild;q.observe(p)});const Z=w.selectAll(_("foreignObject"));Z.each(function(){var a;const p=(a=this.firstChild)==null?void 0:a.firstChild;q.unobserve(p)});const Y=R.merge(K),pt=c.flatMap(a=>{var p;return(p=a.payload)!=null&&p.fold?[]:a.children.map(y=>({source:a,target:y}))}),j=this.g.selectAll(_(ze)).data(pt,a=>a.target.state.key),ft=j.exit(),gt=j.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",a=>a.target.state.depth).attr("data-path",a=>a.target.state.path).attr("d",a=>{const p=m(a.target),y=[p.x+p.width,p.y+p.height];return T({source:y,target:y})}).attr("stroke-width",0).merge(j);this.svg.style("--markmap-max-width",s?`${s}px`:null),await new Promise(requestAnimationFrame),this._relayout(),k=k.data(v?[this._getHighlightRect(v)]:[]).join("rect"),this.transition(k).attr("x",a=>a.x).attr("y",a=>a.y).attr("width",a=>a.width).attr("height",a=>a.height),C.attr("transform",a=>{const p=m(a);return`translate(${p.x+p.width-a.state.rect.width},${p.y+p.height-a.state.rect.height})`}),this.transition(w).attr("transform",a=>{const p=x(a),y=p.x+p.width-a.state.rect.width,E=p.y+p.height-a.state.rect.height;return`translate(${y},${E})`}).remove(),this.transition($).attr("transform",a=>`translate(${a.state.rect.x},${a.state.rect.y})`);const mt=w.selectAll(_("line"));this.transition(mt).attr("x1",a=>a.state.rect.width).attr("stroke-width",0),F.attr("x1",a=>a.state.rect.width).attr("x2",a=>a.state.rect.width),N.attr("y1",a=>a.state.rect.height+h(a)/2).attr("y2",a=>a.state.rect.height+h(a)/2),this.transition(N).attr("x1",-1).attr("x2",a=>a.state.rect.width+2).attr("stroke",a=>r(a)).attr("stroke-width",h);const xt=w.selectAll(_("circle"));this.transition(xt).attr("r",0).attr("stroke-width",0),V.attr("cx",a=>a.state.rect.width).attr("cy",a=>a.state.rect.height+h(a)/2),this.transition(V).attr("r",6).attr("stroke-width","1.5"),this.transition(Z).style("opacity",0),Y.attr("width",a=>Math.max(0,a.state.rect.width-e*2)).attr("height",a=>a.state.rect.height),this.transition(Y).style("opacity",1),this.transition(ft).attr("d",a=>{const p=x(a.target),y=[p.x+p.width,p.y+p.height+h(a.target)/2];return T({source:y,target:y})}).attr("stroke-width",0).remove(),this.transition(gt).attr("stroke",a=>r(a.target)).attr("stroke-width",a=>h(a.target)).attr("d",a=>{const p=a.source,y=a.target,E=[p.state.rect.x+p.state.rect.width,p.state.rect.y+p.state.rect.height+h(p)/2],yt=[y.state.rect.x,y.state.rect.y+y.state.rect.height+h(y)/2];return T({source:E,target:yt})}),i&&this.fit()}transition(t){const{duration:e}=this.options;return t.transition().duration(e)}async fit(t=this.options.maxInitialScale){const e=this.svg.node(),{width:i,height:r}=e.getBoundingClientRect(),{fitRatio:s}=this.options,{x1:h,y1:o,x2:l,y2:d}=this.state.rect,c=l-h,u=d-o,f=Math.min(i/c*s,r/u*s,t),g=zt.translate((i-c*f)/2-h*f,(r-u*f)/2-o*f).scale(f);return this.transition(this.svg).call(this.zoom.transform,g).end().catch(X)}findElement(t){let e;return this.g.selectAll(_(O)).each(function(i){i===t&&(e={data:i,g:this})}),e}async ensureVisible(t,e){var i;const r=(i=this.findElement(t))==null?void 0:i.data;if(!r)return;const s=this.svg.node(),h=s.getBoundingClientRect(),o=S(s),[l,d]=[r.state.rect.x,r.state.rect.x+r.state.rect.width+2].map(k=>k*o.k+o.x),[c,u]=[r.state.rect.y,r.state.rect.y+r.state.rect.height].map(k=>k*o.k+o.y),f={left:0,right:0,top:0,bottom:0,...e},g=[f.left-l,h.width-f.right-d],m=[f.top-c,h.height-f.bottom-u],x=g[0]*g[1]>0?nt(g,Math.abs)/o.k:0,v=m[0]*m[1]>0?nt(m,Math.abs)/o.k:0;if(x||v){const k=o.translate(x,v);return this.transition(this.svg).call(this.zoom.transform,k).end().catch(X)}}async centerNode(t,e){var i;const r=(i=this.findElement(t))==null?void 0:i.data;if(!r)return;const s=this.svg.node(),h=s.getBoundingClientRect(),o=S(s),l=(r.state.rect.x+r.state.rect.width/2)*o.k+o.x,d=(r.state.rect.y+r.state.rect.height/2)*o.k+o.y,c={left:0,right:0,top:0,bottom:0,...e},u=(c.left+h.width-c.right)/2,f=(c.top+h.height-c.bottom)/2,g=(u-l)/o.k,m=(f-d)/o.k;if(g||m){const x=o.translate(g,m);return this.transition(this.svg).call(this.zoom.transform,x).end().catch(X)}}async rescale(t){const e=this.svg.node(),{width:i,height:r}=e.getBoundingClientRect(),s=i/2,h=r/2,o=S(e),l=o.translate((s-o.x)*(1-t)/o.k,(h-o.y)*(1-t)/o.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,l).end().catch(X)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(t=>{t()})}static create(t,e,i=null){const r=new ut(t,e);return i&&r.setData(i).then(()=>{r.fit()}),r}}export{ut as Markmap,_ as childSelector,qt as defaultColorFn,st as defaultOptions,Xe as deriveOptions,Ae as globalCSS,rt as isMacintosh,at as lineWidthFactory,Oe as loadCSS,Te as loadJS,Ce as refreshHook,Kt as simpleHash};
