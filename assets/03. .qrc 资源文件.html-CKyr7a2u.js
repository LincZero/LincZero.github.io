import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as n,o as r,c as s,b as e,e as l,d as i,a}from"./app-Ld2qzqw_.js";const o={},p=a(`<h1 id="qt" tabindex="-1"><a class="header-anchor" href="#qt"><span>Qt</span></a></h1><h1 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h1><h1 id="qrc-资源文件" tabindex="-1"><a class="header-anchor" href="#qrc-资源文件"><span>.qrc 资源文件</span></a></h1><p>这个机制有点特别，以前没碰到过。好像没相对路径这种东西？需要先添加资源文件，可能和编译机制有关吧</p><h2 id="qrc文件" tabindex="-1"><a class="header-anchor" href="#qrc文件"><span>qrc文件</span></a></h2><h3 id="简概" tabindex="-1"><a class="header-anchor" href="#简概"><span>简概</span></a></h3><p>在QtCreator中双击不能打开，需要右击选择打开方式</p><ul><li>Open in Editor，Qt的资源编辑器</li><li>Open with <ul><li>资源编辑器，同Open in Editor</li><li>文本编辑器，以代码形式打开</li><li>二进制编辑器，如名</li><li>System Editor，用电脑自带的编辑器</li></ul></li></ul><p>其中文本编辑器打开，代码如下</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RCC</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>qresource</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>			// 前缀为/from
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>mainwindow.ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>		// 该前缀下的资源
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>qresource</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RCC</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优点" tabindex="-1"><a class="header-anchor" href="#优点"><span>优点</span></a></h3><h2 id="底层原理深入解析" tabindex="-1"><a class="header-anchor" href="#底层原理深入解析"><span>底层原理深入解析</span></a></h2><p>参考：</p>`,13),d={href:"https://www.jianshu.com/p/cc970319caf4",target:"_blank",rel:"noopener noreferrer"},u={href:"https://blog.csdn.net/xld_19920728/article/details/86305026",target:"_blank",rel:"noopener noreferrer"},x=a(`<h3 id="观察" tabindex="-1"><a class="header-anchor" href="#观察"><span>观察</span></a></h3><p>test.qrc 在工程构建后回生成以下两个文件</p><ul><li>qrc_test.cpp</li><li>qrc_test.obj</li></ul><p>注意这两个只是编译过程产生的文件，删除不影响程序正常运行。资源已经被嵌入仅exe文件里了</p><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h3><ul><li><p>qrc文件</p><p>qrc文件本身类似于一个XML格式的文本，用文本编辑器打开则可以看到其XML格式的代码。其记录了所包含的每一个文件的路径</p></li><li><p>编译过程</p><p>关键在于，使用<code>rcc/pyrcc5/pyside2-rcc</code>对该文件进行编译时，</p><p>程序遍历qrc文件里面的每一个文件路径，将该文件的二进制内容写入到相应的输出文件里。</p></li><li><p>举例（pyside2-rcc编译）</p><p>使用的all_day.csv文件是一个纯文本文件，其文件大小为56.4KB；包含该文件路径信息的data.qrc文件大小为85字节；通过pyside2-rcc.exe编译生成的data_rc.py文件大小为70.7KB。（qrc只包含资源路径而不包含文件？）</p><p>此外，当我编译完成了data_rc.py之后，即使我删除all_day.csv文件，程序照样能够正常运行并读取all_day.csv里面的数据。除了pyside2-rcc.exe将all_day.csv的所有信息统统写进了编译生成的data_rc.py这种解释外，我实在想不到为什么一个py文件能够达到70.7KB。</p></li><li><p>qrc文件特性</p><p>有了前面的结论，也就很好解释qrc文件的一些相关特性了，例如：</p><ol><li>目标程序里所有内嵌的资源文件都是只读的，在程序运行时不能修改资源里的文件，只能读取使用。</li><li>当你修改了qrc资源文件包含的任意文件之后，你必须重复<strong>添加-编译</strong>的操作才能使更改生效。</li><li>除了Qt之外的程序想要直接从编译后的文件里面获取信息几乎是不可能的，必须要借助Qt内部接口读取资源文件信息。</li></ol></li></ul><h3 id="rcc-编译工具" tabindex="-1"><a class="header-anchor" href="#rcc-编译工具"><span>rcc 编译工具</span></a></h3><p>RCC 代表 <s>反向 C 编译器（Reverse C Compiler）</s>（不确定）</p><p>Qt 自带的开发工具集里有专门的 rcc 工具，用于将 *.qrc 里面描述的图片、文档等编译成对应的源代码文件 qrc_*.cpp 或者独立的二进制资源文件 *.rcc。下面介绍 rcc 工具的两种用途：</p><ul><li>(1) 生成独立的二进制资源文件 *.rcc</li><li>(2) 应用程序内嵌资源</li></ul><h4 id="生成独立的二进制资源文件-rcc" tabindex="-1"><a class="header-anchor" href="#生成独立的二进制资源文件-rcc"><span>生成独立的二进制资源文件 *.rcc</span></a></h4><ul><li><p>二进制资源文件 *.rcc</p><ul><li>对于太大的图片、音频、视频等文件，不适合集成到目标程序内部，可以放到操作系统文件路径，或者单独编译成外挂资源 *.rcc</li><li>myresource.qrc 包含了很多图片和视频，没法编译成目标程序内嵌资源时，可以打包成 rcc文件，操作如下</li></ul></li><li><p>打包成rcc</p><ul><li><p>打开 Qt 命令行，进入 myresource.qrc 所在的文件夹，执行命令：</p><p><code>rcc -binary myresource.qrc -o myresource.rcc</code></p></li><li><p>rcc 会把 myresource.qrc 里面描述的所有图片、视频等文件，都压缩打包，生成一个二进制的 myresource.rcc 文件，这个 myresource.rcc 包含了所有的资源，这样程序发布时就不需要带一堆乱七八糟的碎文件了，一个 myresource.rcc 搞定</p></li></ul></li><li><p>使用rcc资源</p><ul><li><p>那么代码中如何使用 myresource.rcc 呢？</p></li><li><p>需要在 main 函数开始的位置注册这个独立的二进制资源文件</p><p><code>QResource::registerResource(&quot;/path/to/myresource.rcc&quot;);</code></p></li><li><p>然后也是使用之前类似的虚拟文件路径，比如 &quot;:/images/copy.png&quot; 、&quot;:/images/cat.gif&quot; 。</p></li></ul></li></ul><h4 id="应用程序-内嵌资源" tabindex="-1"><a class="header-anchor" href="#应用程序-内嵌资源"><span>应用程序 <strong>”内嵌资源“</strong></span></a></h4><ul><li><p>内嵌资源</p><ul><li>比起外挂的二进制资源文件*.rcc，应用程序里面更常见的是内嵌资源，接下来介绍内嵌使用方式</li></ul></li><li><p>内嵌方法</p><ul><li><p>如果希望一个资源描述文件 application.qrc 在程序编译时内嵌到目标程序里，需要在 *.pro 文件里加一句话：</p><p><code>RESOURCES += application.qrc</code></p><p>qmake 会自动根据这句话，为 application.qrc 添加编译脚本，其编译过程如下</p></li></ul></li><li><p>编译流程</p><ul><li><p>图解</p><p>![rcc](03.%20.qrc 资源文件.assets/ch05-06-01.png)</p></li><li><p>文字说明</p><ul><li>(1) rcc 工具会<strong>解析</strong> application.qrc 内的 XML 文本，找到需要添加的各种文件，</li><li>(2) 默认情况下，rcc 工具会对这些文件做 ZIP 压缩，然后将压缩后的 ZIP 数据的每个字节转换成比如 0x6f的数值形式，</li><li>(3) 所有文件压缩后的数据对应一个 C++ 静态数组 qt_resource_data[] ，并添加注册、取消注册、初始化、清除等函数和资源描述结构体，</li><li>(4) 最终形成一个 qrc_application.cpp 文件。然后用编译器编译 qrc_application.cpp文件，得到 qrc_applicaotion.o ，链接到目标程序内部，就可以用 &quot;:/images/copy.png&quot; 等形式访问程序内嵌资源了。</li></ul></li><li><p>qrc_*.cpp 细节</p><ul><li><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><pre class="language-c++"><code>// ...
static const unsigned char qt_resource_data[] = {
  // D:/Project/Dev/Platform/Multi/Qt/Test/UseOfficalQtPlugin/UseOfficalQtPlugin/mainwindow.ui
  0x0,0x0,0x3,0xe4,
  0x3c,
  0x3f,0x78,0x6d,0x6c,0x20,0x76,0x65,0x72,0x73,0x69,0x6f,0x6e,0x3d,0x22,0x31,0x2e,
  0x30,0x22,0x20,0x65,0x6e,0x63,0x6f,0x64,0x69,0x6e,0x67,0x3d,0x22,0x55,0x54,0x46,
  0x2d,0x38,0x22,0x3f,0x3e,0xd,0xa,0x3c,0x75,0x69,0x20,0x76,0x65,0x72,0x73,0x69,
  0x6f,0x6e,0x3d,0x22,0x34,0x2e,0x30,0x22,0x3e,0xd,0xa,0x20,0x3c,0x63,0x6c,0x61,
  // ...这里大概有60多行的0x00的数值形式
  0x73,0x6f,0x75,0x72,0x63,0x65,0x73,0x2f,0x3e,0xd,0xa,0x20,0x3c,0x63,0x6f,0x6e,
  0x6e,0x65,0x63,0x74,0x69,0x6f,0x6e,0x73,0x2f,0x3e,0xd,0xa,0x3c,0x2f,0x75,0x69,
  0x3e,0xd,0xa,
};
// ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li><li><p>其他补充</p><ul><li><p>qmake 为内嵌资源添加的 rcc 编译命令，类似下面这样：</p><p>rcc -name application application.qrc -o qrc_application.cpp</p></li><li><p>应用程序的内嵌资源通常不需要手动初始化，但也有例外情况，比如在使用某些链接库中的资源文件时，如果出现使用了正确的文件路径 &quot;:/images/copy.png&quot; 却找不到资源里图片文件的情况，那么需要在使用该资源的类声明里或者在 main 函数里打头的位置加入一句手动初始化：</p><p><code>Q_INIT_RESOURCE(resources);</code>，resources 是指 resources.qrc 的简短名字形式，不需要扩展名</p></li></ul></li></ul><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><h3 id="添加qrc工程资源" tabindex="-1"><a class="header-anchor" href="#添加qrc工程资源"><span>添加qrc工程资源</span></a></h3><p>步骤：</p><ul><li>(1) 把文件夹或文件置于项目文件夹中</li><li>(2) 项目管理器中右键 &gt; 点击添加新文件 &gt; Qt &gt; Qt Resource File &gt; 起名配置 会生成一个资源类别的<code>资源名.qrc</code>文件</li><li>(3) <strong>右击选择<code>Open in Editor</code>的方式打开qrc资源文件并进入编辑界面</strong></li><li>(4) 添加 &gt; 添加前缀（<em>Add Prefix</em>） &gt; 如不添加则填<code>/</code> （默认为<code>/new/prefix1</code>）</li><li>(5) 添加 &gt; 添加文件（<em>Add File</em>） &gt; 选择项目文件 需要先添加并选择前缀才能添加文件。可以选多个文件，而不能选文件夹）</li><li>(6) 编译后即可 成功的话项目文件夹中的qrc文件会多出可折叠的资源 且.pro文件会自动附加一行配置：<code>RESOURCES += \\XXX.qrc</code></li></ul><h3 id="使用qrc工程资源" tabindex="-1"><a class="header-anchor" href="#使用qrc工程资源"><span>使用qrc工程资源</span></a></h3><p>步骤：</p><ul><li><mark>通用：<code>: + 前缀名 + 文件名</code></mark></li><li>举例：QAction，<code>ui-&gt;actionNew-&gt;setIcon(&quot;:/source/favicon.ico&quot;);</code></li><li>举例：QLabel，<code>ui-&gt;qlabel-&gt;setPixmap(QPixmap(&quot;:/Image/butterfly.png&quot;));</code></li><li>举例：QLabel+动图 <ul><li>(1) 头文件，<code>#include &lt;QMovie&gt;</code></li><li>(2) 创建QMovie对象，<code>QMovie * movie = new QMovie(&quot;:/Image/mario.gif&quot;);</code></li><li>(3) 添加到QLabel中，<code>ui-&gt;qlabel-&gt;setMovie(movie); </code></li><li>(4) 播放动图，<code>movie-&gt;start();</code></li></ul></li></ul><p>ui界面中使用qrc工程资源，步骤：</p><ul><li>直接选择就行</li></ul><h3 id="使用qrc注意项" tabindex="-1"><a class="header-anchor" href="#使用qrc注意项"><span>使用qrc注意项</span></a></h3>`,24),h=a("<li>为了管理方便，需要编译进qrc资源文件的那些文件最好放在.qrc的所在文件夹或者其子文件夹内</li><li>前缀（prefix）注意项 <ul><li>在不加前缀的前提下 在程序中调用同级资源文件可以使用<code>(&quot;:file_name&quot;)</code>如<code>file = QFile(&quot;:/all_day.csv&quot;)</code>； 调用子目录资源文件可以用<code>(&quot;:path/to/file&quot;)</code>如<code>file = QFile(&quot;:/resources/all_day.csv&quot;)</code>。</li><li>在加前缀的情况下 在程序中调用同级资源文件可以使用<code>(&quot;:/prefix/file_name&quot;)</code>如<code>file = QFile(&quot;:/data/all_day.csv&quot;)</code>； 调用子目录资源文件可以用<code>(&quot;:/prefix/path/to/file&quot;)</code>如<code>file = QFile(&quot;:/data/resources/all_day.csv&quot;)</code>。</li></ul></li>",2),q=e("code",null,"-binary",-1),m={href:"https://links.jianshu.com/go?to=https%3A%2F%2Fdoc.qt.io%2Fqt-5%2Fresources.html%23external-binary-resources",target:"_blank",rel:"noopener noreferrer"},g=e("code",null,"-binary",-1);function v(E,f){const c=n("ExternalLinkIcon");return r(),s("div",null,[p,e("ul",null,[e("li",null,[e("a",d,[l("【简书】qrc资源文件供外部使用的方法"),i(c)])]),e("li",null,[e("a",u,[l("【CSDN】Qt中rcc工具简介"),i(c)])])]),x,e("ol",null,[h,e("li",null,[l("对于文件大小超过4M的文件，不建议直接编译，而是使用选项"),q,l("，具体文档看"),e("a",m,[l("这里"),i(c)]),l("。另外，在Qt的python绑定中不支持"),g,l("。")])])])}const k=t(o,[["render",v],["__file","03. .qrc 资源文件.html.vue"]]),B=JSON.parse('{"path":"/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/04.%20Project/Platform/Multi/QT%EF%BC%88Cpp%EF%BC%89/04.%20%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6/%E5%88%9B%E5%BB%BA%E6%80%A7%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6/03.%20.qrc%20%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6.html","title":"Qt","lang":"zh-CN","frontmatter":{"description":"Qt 目录 .qrc 资源文件 这个机制有点特别，以前没碰到过。好像没相对路径这种东西？需要先添加资源文件，可能和编译机制有关吧 qrc文件 简概 在QtCreator中双击不能打开，需要右击选择打开方式 Open in Editor，Qt的资源编辑器 Open with 资源编辑器，同Open in Editor 文本编辑器，以代码形式打开 二进制编...","head":[["meta",{"property":"og:url","content":"http://192.168.0.101:8080/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/04.%20Project/Platform/Multi/QT%EF%BC%88Cpp%EF%BC%89/04.%20%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6/%E5%88%9B%E5%BB%BA%E6%80%A7%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6/03.%20.qrc%20%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6.html"}],["meta",{"property":"og:site_name","content":"Linc 的小站"}],["meta",{"property":"og:title","content":"Qt"}],["meta",{"property":"og:description","content":"Qt 目录 .qrc 资源文件 这个机制有点特别，以前没碰到过。好像没相对路径这种东西？需要先添加资源文件，可能和编译机制有关吧 qrc文件 简概 在QtCreator中双击不能打开，需要右击选择打开方式 Open in Editor，Qt的资源编辑器 Open with 资源编辑器，同Open in Editor 文本编辑器，以代码形式打开 二进制编..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"LincZero"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Qt\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\",\\"url\\":\\"https://github.com/LincZero/\\"}]}"]]},"headers":[{"level":1,"title":"Qt","slug":"qt","link":"#qt","children":[]},{"level":1,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":1,"title":".qrc 资源文件","slug":"qrc-资源文件","link":"#qrc-资源文件","children":[{"level":2,"title":"qrc文件","slug":"qrc文件","link":"#qrc文件","children":[{"level":3,"title":"简概","slug":"简概","link":"#简概","children":[]},{"level":3,"title":"优点","slug":"优点","link":"#优点","children":[]}]},{"level":2,"title":"底层原理深入解析","slug":"底层原理深入解析","link":"#底层原理深入解析","children":[{"level":3,"title":"观察","slug":"观察","link":"#观察","children":[]},{"level":3,"title":"原理","slug":"原理","link":"#原理","children":[]},{"level":3,"title":"rcc 编译工具","slug":"rcc-编译工具","link":"#rcc-编译工具","children":[{"level":4,"title":"生成独立的二进制资源文件 *.rcc","slug":"生成独立的二进制资源文件-rcc","link":"#生成独立的二进制资源文件-rcc","children":[]},{"level":4,"title":"应用程序 ”内嵌资源“","slug":"应用程序-内嵌资源","link":"#应用程序-内嵌资源","children":[]}]}]},{"level":2,"title":"使用","slug":"使用","link":"#使用","children":[{"level":3,"title":"添加qrc工程资源","slug":"添加qrc工程资源","link":"#添加qrc工程资源","children":[]},{"level":3,"title":"使用qrc工程资源","slug":"使用qrc工程资源","link":"#使用qrc工程资源","children":[]},{"level":3,"title":"使用qrc注意项","slug":"使用qrc注意项","link":"#使用qrc注意项","children":[]}]}]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":7.29,"words":2186},"filePathRelative":"MdNote_Public/01. 设计开发与数据生产/Develop/04. Project/Platform/Multi/QT（Cpp）/04. 辅助文件/创建性辅助文件/03. .qrc 资源文件.md","autoDesc":true}');export{k as comp,B as data};
