import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e as t}from"./app-yixEWCFr.js";const p="/assets/23-哲学家进餐模型-Bd5uWL8L.jpg",e="/assets/25-哲学家进餐-方案一问题-zX2Htei2.jpg",o="/assets/27-哲学家进餐-方案二问题-CRM4RROu.jpg",c="/assets/29-哲学家进餐-方案三-图解-B7iLv9vm.jpg",i="/assets/31-哲学家进餐-方案四-图解-DDUcLSpF.jpg",l={},u=t('<h1 id="经典同步问题" tabindex="-1"><a class="header-anchor" href="#经典同步问题"><span>经典同步问题</span></a></h1><h2 id="哲学家就餐问题" tabindex="-1"><a class="header-anchor" href="#哲学家就餐问题"><span>哲学家就餐问题</span></a></h2><p>当初我在校招的时候，面试官也问过「哲学家就餐」这道题目，我当时听的一脸懵逼，无论面试官怎么讲述这个问题，我也始终没听懂，就莫名其妙的说这个问题会「死锁」。</p><p>当然，我这回答槽透了，所以当场 game over，残酷又悲惨故事，就不多说了，反正当时菜就是菜。</p><p>时至今日，看我来图解这道题。</p><figure><img src="'+p+`" alt="哲学家就餐的问题" tabindex="0" loading="lazy"><figcaption>哲学家就餐的问题</figcaption></figure><p>先来看看哲学家就餐的问题描述：</p><ul><li><code>5</code> 个老大哥哲学家，闲着没事做，围绕着一张圆桌吃面；</li><li>巧就巧在，这个桌子只有 <code>5</code> 支叉子，每两个哲学家之间放一支叉子；</li><li>哲学家围在一起先思考，思考中途饿了就会想进餐；</li><li><strong>奇葩的是，这些哲学家要两支叉子才愿意吃面，也就是需要拿到左右两边的叉子才进餐</strong>；</li><li><strong>吃完后，会把两支叉子放回原处，继续思考</strong>；</li></ul><p>那么问题来了，如何保证哲学家们的动作有序进行，而不会出现有人永远拿不到叉子呢？</p><h3 id="方案一-拿叉子是互斥事件" tabindex="-1"><a class="header-anchor" href="#方案一-拿叉子是互斥事件"><span>方案一，拿叉子是互斥事件</span></a></h3><p>我们用信号量的方式，也就是 PV 操作来尝试解决它，代码如下：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span>					</span><span class="token comment">// 哲学家个数</span></span>
semaphore fork<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>			<span class="token comment">// 信号量初值为1 (信号量数组)</span>
							<span class="token comment">// 也就是叉子的个数</span>

<span class="token keyword">void</span> <span class="token function">smart_person</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// i 为哲学家编号 0-4</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 哲学家思考</span>
        <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 去拿左边的又子</span>
        <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 去拿右边的叉子</span>
        <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 进餐</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 放下左边的叉子</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 放下右边的叉子</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的程序，好似很自然。拿起叉子用 P 操作，代表有叉子就直接用，没有叉子时就等待其他哲学家放回叉子。</p><figure><img src="`+e+`" alt="方案一的问题" tabindex="0" loading="lazy"><figcaption>方案一的问题</figcaption></figure><p>不过，这种解法存在一个极端的问题：<strong>假设五位哲学家同时拿起左边的叉子，桌面上就没有叉子了， 这样就没有人能够拿到他们右边的叉子，也就说每一位哲学家都会在 <code>P(fork[(i + 1) % N ])</code> 这条语句阻塞了，很明显这发生了死锁的现象</strong>。</p><h3 id="方案二-吃饭是互斥事件" tabindex="-1"><a class="header-anchor" href="#方案二-吃饭是互斥事件"><span>方案二，吃饭是互斥事件</span></a></h3><p>既然「方案一」会发生同时竞争左边叉子导致死锁的现象，那么我们就在拿叉子前，加个互斥信号量，代码如下：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span>					</span><span class="token comment">// 哲学家个数</span></span>
semaphore fork<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>			<span class="token comment">// 每个叉子一个信号量，初值为1 (信号量数组)</span>
semaphore mutex<span class="token punctuation">;</span>			<span class="token comment">// 互斥信号量，初值为 1</span>

<span class="token keyword">void</span> <span class="token function">smart_person</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// i 为哲学家编号 0-4</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 哲学家思考</span>
        <span class="token function">P</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 进入临界区</span>
        <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 去拿左边的叉子</span>
        <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 去拿右边的又子</span>
        <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 进餐</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 放下左边的又子</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 放下右边的又子</span>
        <span class="token function">V</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 退出临界区</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面程序中的互斥信号量的作用就在于，<strong>只要有一个哲学家进入了「临界区」，也就是准备要拿叉子时，其他哲学家都不能动，只有这位哲学家用完叉子了，才能轮到下一个哲学家进餐。</strong></p><figure><img src="`+o+`" alt="方案二的问题" tabindex="0" loading="lazy"><figcaption>方案二的问题</figcaption></figure><p>方案二虽然能让哲学家们按顺序吃饭，但是每次进餐只能有一位哲学家，而桌面上是有 5 把叉子，按道理是能可以有两个哲学家同时进餐的，所以从效率角度上，这不是最好的解决方案。</p><h3 id="方案三-奇偶调整" tabindex="-1"><a class="header-anchor" href="#方案三-奇偶调整"><span>方案三，奇偶调整</span></a></h3><p>那既然方案二使用互斥信号量，会导致只能允许一个哲学家就餐，那么我们就不用它。</p><p>另外，方案一的问题在于，会出现所有哲学家同时拿左边刀叉的可能性，那我们就避免哲学家可以同时拿左边的刀叉，采用分支结构，根据哲学家的编号的不同，而采取不同的动作。</p><p><strong>即让偶数编号的哲学家「先拿左边的叉子后拿右边的叉子」，奇数编号的哲学家「先拿右边的叉子后拿左边的叉子」。</strong></p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span>					</span><span class="token comment">// 哲学家个数</span></span>
semaphore fork<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>			<span class="token comment">// 每个叉子一个信号量，初值为1 (信号量数组)</span>

<span class="token keyword">void</span> <span class="token function">smart_person</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// i 为哲学家编号 0-4</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 哲学家思考</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 去拿左边的叉子</span>
            <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 去拿右边的叉子</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 去拿右边的叉子</span>
            <span class="token function">P</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 去拿左边的叉子</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 进餐</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 放下左边的又子</span>
        <span class="token function">V</span><span class="token punctuation">(</span>fork<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 放下右边的又子</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的程序，在 P 操作时，根据哲学家的编号不同，拿起左右两边叉子的顺序不同。另外，V 操作是不需要分支的，因为 V 操作是不会阻塞的。</p><figure><img src="`+c+`" alt="方案三可解决问题" tabindex="0" loading="lazy"><figcaption>方案三可解决问题</figcaption></figure><p>方案三即不会出现死锁，也可以两人同时进餐。</p><h3 id="方案四-状态码-信号量数组" tabindex="-1"><a class="header-anchor" href="#方案四-状态码-信号量数组"><span>方案四，状态码+信号量数组</span></a></h3><p>在这里再提出另外一种可行的解决方案，我们<strong>用一个数组 state 来记录每一位哲学家的三个状态，分别是在进餐状态、思考状态、饥饿状态（正在试图拿叉子）。</strong></p><p>那么，<strong>一个哲学家只有在两个邻居都没有进餐时，才可以进入进餐状态。</strong></p><p>第 <code>i</code> 个哲学家的左邻右舍，则由宏 <code>LEFT</code> 和 <code>RIGHT</code> 定义：</p><ul><li><em>LEFT</em> : ( i + 5 - 1 ) % 5</li><li><em>RIGHT</em> : ( i + 1 ) % 5</li></ul><p>比如 i 为 2，则 <code>LEFT</code> 为 1，<code>RIGHT</code> 为 3。</p><p>具体代码实现如下：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span>					</span><span class="token comment">// 哲学家个数</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LEFT</span><span class="token expression"><span class="token punctuation">(</span>i<span class="token operator">+</span>N<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>N		</span><span class="token comment">// i的左边邻居编号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RIGHT</span><span class="token expression"><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span> N		</span><span class="token comment">// i 的右边邻居编号</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">THINKING</span> <span class="token expression">O			</span><span class="token comment">// 思考状态</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HUNGRY</span> <span class="token expression"><span class="token number">1</span>			</span><span class="token comment">// 饥饿状态</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EATING</span> <span class="token expression"><span class="token number">2</span>			</span><span class="token comment">// 进餐状态</span></span>

<span class="token keyword">int</span> state<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">// 数组记录每个哲学家的状态</span>
semaphore s<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">// 每个哲学家一个信号量，初值 0 (信号量数组)</span>
semaphore mutex<span class="token punctuation">;</span>			<span class="token comment">// 互斥信号量，初值为 1</span>

<span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>			<span class="token comment">// i为哲学家编号 0-4</span>
	<span class="token comment">// 如果i号的左边右边哲学家都不是进餐状态，把i号哲学家标记为进餐状态</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> HUNGRY <span class="token operator">&amp;&amp;</span>
        State<span class="token punctuation">[</span>LEFT<span class="token punctuation">]</span> <span class="token operator">!=</span> EATING <span class="token operator">&amp;&amp;</span>
        State<span class="token punctuation">[</span>RIGHT<span class="token punctuation">]</span> <span class="token operator">!=</span> EATING<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> EATING	<span class="token comment">// 两把叉子到手，进餐状态</span>
        <span class="token function">V</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 通知第 i 哲学家可以进餐了</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    
<span class="token comment">// 功能:要么拿到两把叉子，要么被阻塞起来</span>
<span class="token keyword">void</span> <span class="token function">take_forks</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> 	<span class="token comment">// i为哲学家编号 0-4</span>
	<span class="token function">P</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 进入临界区</span>
	state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> HUNGRY<span class="token punctuation">;</span>		<span class="token comment">// 标记哲学家处于饥饿状态</span>
	<span class="token function">test</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 尝试获取 2 支叉子</span>
	<span class="token function">V</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 离开临界区</span>
	<span class="token function">P</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 没有叉子则阻塞，有叉子则继续正常执行</span>
<span class="token punctuation">}</span>

<span class="token comment">// 功能:把两把叉子放回原处，并在需要的时候，去唤醒左邻右舍</span>
<span class="token keyword">void</span> put <span class="token function">forks</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>		<span class="token comment">// i为哲学家编号 0-4</span>
	<span class="token function">P</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 进入临界区</span>
    state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span> THINKING<span class="token punctuation">;</span>		<span class="token comment">// 吃完饭了，交出叉子，标记思考状态</span>
    <span class="token function">test</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 检查左边的左邻右舍是否在进餐，没则唤醒</span>
    <span class="token function">test</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 检查右边的左邻右舍是否在进餐，没则唤醒</span>
    <span class="token function">V</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 离开临界区</span>
<span class="token punctuation">}</span>

<span class="token comment">// 哲学家主代码</span>
<span class="token keyword">void</span> <span class="token function">smart_person</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">// i为哲学家编号 0-4</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">think</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 思考</span>
        <span class="token function">take_forks</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 准备拿去叉子吃饭</span>
        <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 就餐</span>
        <span class="token function">put_forks</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 吃完放回叉子</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的程序使用了一个信号量数组，每个信号量对应一位哲学家，这样在所需的叉子被占用时，想进餐的哲学家就被阻塞。</p><p>注意，每个进程/线程将 <code>smart_person</code> 函数作为主代码运行，而其他 <code>take_forks</code>、<code>put_forks</code> 和 <code>test</code> 只是普通的函数，而非单独的进程/线程。</p><figure><img src="`+i+`" alt="方案四也可解决问题" tabindex="0" loading="lazy"><figcaption>方案四也可解决问题</figcaption></figure><p>方案四同样不会出现死锁，也可以两人同时进餐</p><h2 id="读者-写者问题" tabindex="-1"><a class="header-anchor" href="#读者-写者问题"><span>读者-写者问题</span></a></h2><p>前面的「哲学家进餐问题」对于互斥访问有限的竞争问题（如 I/O 设备）一类的建模过程十分有用。</p><p>另外，还有个著名的问题是「读者-写者」，它为数据库访问建立了一个模型。</p><p>读者只会读取数据，不会修改数据，而写者即可以读也可以修改数据。</p><p>读者-写者的问题描述：</p><ul><li>「读-读」允许：同一时刻，允许多个读者同时读</li><li>「读-写」互斥：没有写者时读者才能读，没有读者时写者才能写</li><li>「写-写」互斥：没有其他写者时，写者才能写</li></ul><p>（话说这个有点像读写锁问题）</p><p>接下来，提出几个解决方案来分析分析。</p><h3 id="方案一-读者优先" tabindex="-1"><a class="header-anchor" href="#方案一-读者优先"><span>方案一，读者优先</span></a></h3><p>使用信号量的方式来尝试解决：</p><ul><li>信号量 <code>wMutex</code>：控制写操作的互斥信号量，初始值为 1 ；</li><li>读者计数 <code>rCount</code>：正在进行读操作的读者个数，初始化为 0；</li><li>信号量 <code>rCountMutex</code>：控制对 rCount 读者计数器的互斥修改，初始值为 1；</li></ul><p>接下来看看代码的实现：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>semaphore wMutex<span class="token punctuation">;</span>			<span class="token comment">// 控制写操作的互斥信号量，初始值为 1</span>

<span class="token keyword">int</span> rCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>				<span class="token comment">// 正在进行读操作的读者个数，初始化为0</span>
semaphore rCountMutex<span class="token punctuation">;</span>		<span class="token comment">// 控制对 Rcount 的互斥修改，初始值为 1</span>

<span class="token comment">// 写者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">P</span><span class="token punctuation">(</span>wMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 进入临界区</span>
		<span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">V</span><span class="token punctuation">(</span>wMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 进入临界区</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 读者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token function">P</span><span class="token punctuation">(</span>wMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 如果有写者，则阻塞写者</span>
        <span class="token punctuation">}</span>
        rCount<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">// 读者计数 +1</span>
        <span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
        
        <span class="token function">read</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 读数据</span>
        
        <span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
        rCount<span class="token operator">--</span><span class="token punctuation">;</span>			<span class="token comment">// 读完数据，准备离开</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token function">V</span><span class="token punctuation">(</span>wMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 最后一个读者离开了，则唤醒写者</span>
        <span class="token punctuation">}</span>
        <span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的这种实现，是读者优先的策略，因为只要有读者正在读的状态，后来的读者都可以直接进入，如果读者持续不断进入，则写者会处于饥饿状态。</p><h3 id="方案二-写者优先" tabindex="-1"><a class="header-anchor" href="#方案二-写者优先"><span>方案二，写者优先</span></a></h3><p>那既然有读者优先策略，自然也有写者优先策略：</p><ul><li>只要有写者准备要写入，写者应尽快执行写操作，后来的读者就必须阻塞；</li><li>如果有写者持续不断写入，则读者就处于饥饿；</li></ul><p>在方案一的基础上新增如下变量：</p><ul><li>信号量 <code>rMutex</code>：控制读者进入的互斥信号量，初始值为 1；</li><li>信号量 <code>wDataMutex</code>：控制写者写操作的互斥信号量，初始值为 1；</li><li>写者计数 <code>wCount</code>：记录写者数量，初始值为 0；</li><li>信号量 <code>wCountMutex</code>：控制 wCount 互斥修改，初始值为 1；</li></ul><p>具体实现如下代码：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> rCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>				<span class="token comment">// 正在进行读操作的读者个数，初始化为0</span>
semaphore rCountMutex<span class="token punctuation">;</span>		<span class="token comment">// 控制对 Rcount 的互斥修改，初始值为 1</span>
semaphore rMutex<span class="token punctuation">;</span>			<span class="token comment">// 控制读者进入的互斥信号量者，初始值为1</span>

<span class="token keyword">int</span> wCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>				<span class="token comment">// 正在进行读操作的写者个数，初始化为0</span>
semaphore wCountMutex		<span class="token comment">// 控制 wCount 互斥修改，初始值为 1</span>
semaphore wDataMutex		<span class="token comment">// 控制写者写操作的互斥信号量，初始值为 1</span>

<span class="token comment">// 写者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">P</span><span class="token punctuation">(</span>wCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>wCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token function">P</span><span class="token punctuation">(</span>rMutex<span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">// 当第一个写者进入，如果有读者则阻塞读者</span>
        <span class="token punctuation">}</span>
        wCount<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">// 写者计数 + 1</span>
        <span class="token function">V</span><span class="token punctuation">(</span>wCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
        
        <span class="token function">P</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 写者写操作之间互斥，进入临界区</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 写数据</span>
        <span class="token function">V</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
        
        <span class="token function">P</span><span class="token punctuation">(</span>wCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
        wCount<span class="token operator">--</span><span class="token punctuation">;</span>			<span class="token comment">// 写完数据，准备离开</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> wCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token function">V</span><span class="token punctuation">(</span>rMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 最后一个写者离开了，则唤醒读者</span>
        <span class="token punctuation">}</span>
        <span class="token function">V</span><span class="token punctuation">(</span>wCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
   
<span class="token comment">// 读者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">P</span><span class="token punctuation">(</span>rMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">P</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 当第一个读者进入，如果有写者则阻塞写者写操作</span>
        <span class="token punctuation">}</span>
		rCount<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
		<span class="token function">V</span><span class="token punctuation">(</span>rMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
		<span class="token function">read</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 读数据</span>
		
        <span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
		rCount<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">V</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 当没有读者了，则唤醒阻塞中写者的写操作</span>
        <span class="token punctuation">}</span>
        <span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，这里 <code>rMutex</code> 的作用，开始有多个读者读数据，它们全部进入读者队列，此时来了一个写者，执行了 <code>P(rMutex)</code> 之后，后续的读者由于阻塞在 <code>rMutex</code> 上，都不能再进入读者队列，而写者到来，则可以全部进入写者队列，因此保证了写者优先。</p><p>同时，第一个写者执行了 <code>P(rMutex)</code> 之后，也不能马上开始写，必须等到所有进入读者队列的读者都执行完读操作，通过 <code>V(wDataMutex)</code> 唤醒写者的写操作。</p><h3 id="方案三-公平策略" tabindex="-1"><a class="header-anchor" href="#方案三-公平策略"><span>方案三，公平策略</span></a></h3><p>既然读者优先策略和写者优先策略都会造成饥饿的现象，那么我们就来实现一下公平策略。</p><p>公平策略：</p><ul><li>优先级相同；</li><li>写者、读者互斥访问；</li><li>只能一个写者访问临界区；</li><li>可以有多个读者同时访问临界资源；</li></ul><p>具体代码实现：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> rCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>				<span class="token comment">// 正在进行读操作的读者个数，初始化为 0</span>
semaphore rCountMutex<span class="token punctuation">;</span>		<span class="token comment">// 控制对 Rcount 的互斥修改，初始值为 1</span>
semaphore wDataMutex<span class="token punctuation">;</span>		<span class="token comment">// 控制写者写操作的互斥信号量，初始值为 1</span>
semaphore flag<span class="token punctuation">;</span>				<span class="token comment">// 用于实现公平竞争，初始值为 1</span>

<span class="token comment">// 写者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">P</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">P</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 写者写操作之间互斥，进入临界区</span>
		<span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 写数据</span>
		<span class="token function">V</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
        <span class="token function">V</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 读者进程/线程执行的函数</span>
<span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">P</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">P</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当第一个读者进入，如果有写者则阻塞写者写操作</span>
        <span class="token punctuation">}</span>
        rCount<span class="token operator">++</span><span class="token operator">:</span>
		<span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
		<span class="token function">V</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token comment">// 读数据</span>
		<span class="token function">P</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 进入临界区</span>
		rCount<span class="token operator">--</span><span class="token operator">:</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">V</span><span class="token punctuation">(</span>wDataMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 当没有读者了，则唤醒阻塞中写者的写操作</span>
        <span class="token punctuation">}</span>
		<span class="token function">V</span><span class="token punctuation">(</span>rCountMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 离开临界区</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看完代码不知你是否有这样的疑问，为什么加了一个信号量 <code>flag</code>，就实现了公平竞争？</p><p>对比方案一的读者优先策略，可以发现，读者优先中只要后续有读者到达，读者就可以进入读者队列， 而写者必须等待，直到没有读者到达。</p><p>没有读者到达会导致读者队列为空，即 <code>rCount==0</code>，此时写者才可以进入临界区执行写操作。</p><p>而这里 <code>flag</code> 的作用就是阻止读者的这种特殊权限（特殊权限是只要读者到达，就可以进入读者队列）。</p><p>比如：开始来了一些读者读数据，它们全部进入读者队列，此时来了一个写者，执行 <code>P(falg)</code> 操作，使得后续到来的读者都阻塞在 <code>flag</code> 上，不能进入读者队列，这会使得读者队列逐渐为空，即 <code>rCount</code> 减为 0。</p><p>这个写者也不能立马开始写（因为此时读者队列不为空），会阻塞在信号量 <code>wDataMutex</code> 上，读者队列中的读者全部读取结束后，最后一个读者进程执行 <code>V(wDataMutex)</code>，唤醒刚才的写者，写者则继续开始进行写操作。</p>`,76),k=[u];function d(r,m){return s(),a("div",null,k)}const f=n(l,[["render",d],["__file","03. 经典同步问题.html.vue"]]),h=JSON.parse('{"path":"/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E7%BA%BF%E6%80%A7%E5%AD%A6%E4%B9%A0%E7%89%88/%E3%80%8A%E5%B0%8F%E6%9E%97coding_%E5%9B%BE%E8%A7%A3%E7%B3%BB%E5%88%97%E3%80%8B/01.%20%E5%9B%BE%E8%A7%A3%E7%B3%BB%E7%BB%9F/05.%20%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/03.%20%E7%BA%BF%E7%A8%8B%E5%86%B2%E7%AA%81/03.%20%E7%BB%8F%E5%85%B8%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98.html","title":"经典同步问题","lang":"zh-CN","frontmatter":{"description":"经典同步问题 哲学家就餐问题 当初我在校招的时候，面试官也问过「哲学家就餐」这道题目，我当时听的一脸懵逼，无论面试官怎么讲述这个问题，我也始终没听懂，就莫名其妙的说这个问题会「死锁」。 当然，我这回答槽透了，所以当场 game over，残酷又悲惨故事，就不多说了，反正当时菜就是菜。 时至今日，看我来图解这道题。 哲学家就餐的问题哲学家就餐的问题 先来...","head":[["meta",{"property":"og:url","content":"http://192.168.0.101:8080/MdNote_Public/01.%20%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%94%9F%E4%BA%A7/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E7%BA%BF%E6%80%A7%E5%AD%A6%E4%B9%A0%E7%89%88/%E3%80%8A%E5%B0%8F%E6%9E%97coding_%E5%9B%BE%E8%A7%A3%E7%B3%BB%E5%88%97%E3%80%8B/01.%20%E5%9B%BE%E8%A7%A3%E7%B3%BB%E7%BB%9F/05.%20%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/03.%20%E7%BA%BF%E7%A8%8B%E5%86%B2%E7%AA%81/03.%20%E7%BB%8F%E5%85%B8%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98.html"}],["meta",{"property":"og:site_name","content":"Linc 的小站"}],["meta",{"property":"og:title","content":"经典同步问题"}],["meta",{"property":"og:description","content":"经典同步问题 哲学家就餐问题 当初我在校招的时候，面试官也问过「哲学家就餐」这道题目，我当时听的一脸懵逼，无论面试官怎么讲述这个问题，我也始终没听懂，就莫名其妙的说这个问题会「死锁」。 当然，我这回答槽透了，所以当场 game over，残酷又悲惨故事，就不多说了，反正当时菜就是菜。 时至今日，看我来图解这道题。 哲学家就餐的问题哲学家就餐的问题 先来..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"LincZero"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"经典同步问题\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\",\\"url\\":\\"https://github.com/LincZero/\\"}]}"]]},"headers":[{"level":1,"title":"经典同步问题","slug":"经典同步问题","link":"#经典同步问题","children":[{"level":2,"title":"哲学家就餐问题","slug":"哲学家就餐问题","link":"#哲学家就餐问题","children":[{"level":3,"title":"方案一，拿叉子是互斥事件","slug":"方案一-拿叉子是互斥事件","link":"#方案一-拿叉子是互斥事件","children":[]},{"level":3,"title":"方案二，吃饭是互斥事件","slug":"方案二-吃饭是互斥事件","link":"#方案二-吃饭是互斥事件","children":[]},{"level":3,"title":"方案三，奇偶调整","slug":"方案三-奇偶调整","link":"#方案三-奇偶调整","children":[]},{"level":3,"title":"方案四，状态码+信号量数组","slug":"方案四-状态码-信号量数组","link":"#方案四-状态码-信号量数组","children":[]}]},{"level":2,"title":"读者-写者问题","slug":"读者-写者问题","link":"#读者-写者问题","children":[{"level":3,"title":"方案一，读者优先","slug":"方案一-读者优先","link":"#方案一-读者优先","children":[]},{"level":3,"title":"方案二，写者优先","slug":"方案二-写者优先","link":"#方案二-写者优先","children":[]},{"level":3,"title":"方案三，公平策略","slug":"方案三-公平策略","link":"#方案三-公平策略","children":[]}]}]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":13.48,"words":4043},"filePathRelative":"MdNote_Public/01. 设计开发与数据生产/Develop/02. Theory/Computer/03. 计算机系统 - 线性学习版/《小林coding_图解系列》/01. 图解系统/05. 进程管理/03. 线程冲突/03. 经典同步问题.md","autoDesc":true}');export{f as comp,h as data};
