import{_ as n,e as l,g as a,f as s,o as e}from"./app-HvNDXJEG.js";const p={};function t(h,i){return e(),l("div",null,i[0]||(i[0]=[a(`<h2 id="dpdk环境部分-不建议先单独安装dpdk-而是按dperf的说明安装dpdk" tabindex="-1"><a class="header-anchor" href="#dpdk环境部分-不建议先单独安装dpdk-而是按dperf的说明安装dpdk"><span>DPDK环境部分 (不建议先单独安装DPDK，而是按DPerf的说明安装DPDK)</span></a></h2><h3 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h3><ul><li>官网：https://www.dpdk.org/</li><li>下载：http://core.dpdk.org/download/</li><li>安装：http://core.dpdk.org/doc/quick-start/</li><li>文档：https://doc.dpdk.org/guides/linux_gsg/index.html</li></ul><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdk.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">meson</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ninja</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ninja</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">meson</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldconfig</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装后的二进制库路径：/usr/local/lib/x86_64-linux-gnu/</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装后的头文件路径：/usr/local/include/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="卸载环境" tabindex="-1"><a class="header-anchor" href="#卸载环境"><span>卸载环境</span></a></h3><p>删除库和头文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/include/dpdk</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/lib/librte_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>卸载DPDK驱动</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rmmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> igb_uio</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rmmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rte_kni</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>删除配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/etc/rte.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="额外参考-dperf" tabindex="-1"><a class="header-anchor" href="#额外参考-dperf"><span>额外参考 - dperf</span></a></h3><p>另外 dperf 也写了个自动编译脚本：https://dperf.org/doc/html/compile-dpdk-22.11</p><h3 id="额外参考-packetmaster" tabindex="-1"><a class="header-anchor" href="#额外参考-packetmaster"><span>额外参考 - packetMaster</span></a></h3><p>PacketMaster自动化脚本</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Debian10 编译环境安装</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 非零退出状态的命令时立即终止</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># apt换源</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/apt/sources.list</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/apt/sources.list_bak</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sources.list</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/apt/sources.list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更新apt（如果出现GPG错误，请注释这一行，脚本先更新GPG密钥）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取GPG最新密钥</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gnupg</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt-key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> adv</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --refresh-keys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --keyserver</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> keyserver.ubuntu.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果还是报GPG密钥错误，获取指定密钥</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 0E98404D386FA1D9 6ED0E7B82643E131</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upgrade</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装环境</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build-essential</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cmake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> subversion</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nano</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3-pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ninja-build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net-tools</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pciutils</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libpcap-dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pkg-config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iproute2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ccache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pip换源</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pip3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> global.index-url</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://pypi.tuna.tsinghua.edu.cn/simple</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 清华</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pip3 config set global.index-url http://mirrors.aliyun.com/pypi/simple/ # 阿里云</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pip3 config set global.index-url https://pypi.mirrors.ustc.edu.cn/simple/ # 中科大</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pip3 config set global.index-url http://pypi.douban.com/simple/ # 豆瓣</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建文件夹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/root/packetmaster_install_script&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/root/packetmaster_install_script&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># python环境</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pip3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> meson</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pyelftools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># DPDK</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/packetmaster_install_script</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdksource</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://gitee.com/mirrors/dpdksource.git</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # gitee镜像</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># git clone https://github.com/DPDK/dpdk</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdksource</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checkout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v22.11</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">meson</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ninja</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ninja</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cryptopp</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/packetmaster_install_script</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cryptopp</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://gitee.com/mirrors/cryptopp.git</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # gitee镜像</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># git clone https://github.com/weidai11/cryptopp</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cryptopp</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install-lib</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># PcapPlusPlus</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/packetmaster_install_script</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PcapPlusPlus</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://gitee.com/mirrors/PcapPlusPlus.git</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # gitee镜像</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># git clone https://github.com/seladb/PcapPlusPlus</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PcapPlusPlus</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cmake</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -DPCAPPP_USE_DPDK=true</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pcap++</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -j</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pcap++</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -j</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># PacketMaster</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/packetmaster_install_script</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packetmaster</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://mochazi:Aa123456@192.168.1.50/packetmaster/packetmaster.git</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packetmaster/</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Set the username and password</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">username</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mochazi&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Aa123456&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Define the target URL</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">target_url</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.1.50/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Generate the URL with username and password</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">url_with_credentials</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">username</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">@</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">target_url</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replace the URL in the .gitmodules file</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;s|url = http://192.168.1.50|url = </span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">url_with_credentials</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">|&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .gitmodules</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> submodule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --init</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --recursive</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># install 3rdParty</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3rdParty/</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PcapTool/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cmake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/packetmaster_install_script/packetmaster/scripts/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.sh</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;s/make PacketMaster -j 8/make PacketMaster -j 4/g&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> package.sh</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./package.sh</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpkg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ../release/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.deb</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置UTF-8编码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> LC_ALL</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">UTF-8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更新环境变量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldconfig</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="dperf环境" tabindex="-1"><a class="header-anchor" href="#dperf环境"><span>DPerf环境</span></a></h2><h3 id="参考-1" tabindex="-1"><a class="header-anchor" href="#参考-1"><span>参考</span></a></h3><ul><li><a href="https://github.com/baidu/dperf" target="_blank" rel="noopener noreferrer">Github</a>，有中文 README.md</li><li><a href="https://dperf.org/" target="_blank" rel="noopener noreferrer">官方文档</a>，主要参考</li><li><a href="https://dperf.org/doc/html/configuration" target="_blank" rel="noopener noreferrer">参数说明</a></li><li>配置参考：https://dperf.org/doc/html/compile-dperf-on-ubuntu-22.04（他这里有N个版本的编译流程，就很烦）</li><li>配置参考：https://github.com/digger-yu/blog/blob/main/how%20to%20install%20dperf%20on%20ubuntu.md（居然还有个中文版的）</li></ul><h3 id="安装-1" tabindex="-1"><a class="header-anchor" href="#安装-1"><span>安装</span></a></h3><p>与他DPerf的流程不同，他这个默认是要指定安装位置的。如果之前安装了，就把build文件夹删了</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译 DPDK</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">……</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">meson</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prefix=/root/CLion/dpdk/dpdk-stable-22.11.4/mydpdk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Denable_kmods=true</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Ddisable_libs=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ninja</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译 dperf</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dperf</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> PKG_CONFIG_PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">CLion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dpdk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dpdk-stable-22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mydpdk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lib</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x86_64-linux-gnu</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pkgconfig</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 运行 dperf</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> LD_LIBRARY_PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">CLion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dpdk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dpdk-stable-22</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mydpdk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lib</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x86_64-linux-gnu</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./build/dperf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是默认的方式安装DPDK，对应的路径有所不同：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@msy:/usr#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> find</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pkgconfig</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./lib/x86_64-linux-gnu/pkgconfig</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./lib/pkgconfig</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./share/pkgconfig</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="faq" tabindex="-1"><a class="header-anchor" href="#faq"><span>FAQ</span></a></h3><h4 id="官方faq" tabindex="-1"><a class="header-anchor" href="#官方faq"><span>官方FAQ</span></a></h4><p>https://dperf.org/doc/html/dperf-faq</p><p>目录：</p><ol><li>支持性 <ol><li>支持哪些DPDK版本？</li><li>支持哪些平台？</li><li>支持哪些网卡？</li><li>支持哪些操作系统？</li><li>有安装包吗？</li></ol></li><li>环境类 <ol><li>如何编译dperf？</li><li>如何配置大页和绑定网卡？</li><li>如何运行 dperf，参数是什么？</li><li>启动失败报网卡初始化失败</li><li>启动失败报找不到网关</li></ol></li><li>配置类 <ol><li>如何配置 dperf？</li><li>我可以在同一台主机上运行客户端和服务器吗？</li><li>我可以在同一台主机上运行客户端和服务器吗？</li><li>统计数据的含义是什么？</li><li>如何测试网络带宽？推荐的初始配置</li></ol></li><li>高级类<br> 7. 如何使用多CPU核心？<br> 8. 如何使用多网卡？<br> 9. 如何使用修改后的源地址测试 DUT（例如第 4 层负载均衡器 DPVS 的 FULLNAT 模式）？<br> 10. 如何验证dperf是否启动成功？</li><li>更多问题 <ol><li>如何贡献？</li><li>如何提问？</li><li>如何学习代码？</li><li>有计划支持HTTPS吗？</li><li>有计划支持DNS吗？</li><li>绩效未达到预期水平？</li><li>如何测试大象流？</li><li>错误：“没有足够的可用端口”</li><li>curl/ab无法访问dperf服务器</li><li>错误：“套接字分配失败”</li></ol></li></ol><h4 id="缺少kni" tabindex="-1"><a class="header-anchor" href="#缺少kni"><span>缺少kni</span></a></h4><p>安装时报错：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">In</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> included</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src/config.h:26,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                 from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src/main.c:24:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">src/port.h:29:10:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fatal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rte_kni.h:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> such</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> directory</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   29</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#include &lt;rte_kni.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |          </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">^~~~~~~~~~~</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">compilation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> terminated.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里rte的其他头文件是有的，但没有这个kni头文件</p><p>解决方法：卸载并重新安装DPDK（根据DPerf而非DPDK官网的方法安装）</p><h4 id="无法设置大页" tabindex="-1"><a class="header-anchor" href="#无法设置大页"><span>无法设置大页</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@msy:~/CLion/dperf/build#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdk-hugepages.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --clear</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (158 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">instead</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@msy:~/CLion/dperf/build#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dpdk-hugepages.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --setup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2048000K</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (158 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">instead</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先检查是否已经启用了大页</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/meminfo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Huge</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AnonHugePages:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ShmemHugePages:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FileHugePages:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HugePages_Total:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     158</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HugePages_Free:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HugePages_Rsvd:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HugePages_Surp:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      158</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Hugepagesize:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       2048</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Hugetlb:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          323584</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/sys/vm/nr_hugepages</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GPT：</p><blockquote><p>在你的情况下，你已经尝试使用<code>dpdk-hugepages.py --clear</code>命令来清除大页，但是这个命令没有成功。这可能是因为有一些DPDK进程仍在运行，占用了这些大页。</p><p>首先，你需要找出哪些进程正在使用大页。你可以使用<code>fuser</code>或<code>lsof</code>命令来查找哪些进程正在使用特定的文件或目录。在这种情况下，你需要查找使用<code>/dev/hugepages</code>目录的进程。</p><p><code>fuser -vm /dev/hugepages</code></p><p>或者</p><p><code>lsof /dev/hugepages</code></p><p>这些命令将列出正在使用大页的所有进程的PID。然后，你可以使用<code>kill</code>命令来停止这些进程。</p><p><code>kill -9 &lt;PID&gt;</code></p><p>一旦所有的DPDK进程都被停止，你就可以再次尝试使用<code>dpdk-hugepages.py --clear</code>命令来清除大页。如果这个命令仍然没有成功，你可以尝试直接修改<code>/sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages</code>文件来清除大页。</p><p><code>echo 0 &gt; /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages</code></p><p>这个命令将会设置系统的大页数量为0，从而清除所有的大页。如果你的系统有多个NUMA节点，你可能需要为每个节点执行这个命令。</p><p>请注意，这些操作需要root权限，所以在执行这些命令时，你可能需要使用<code>sudo</code>。</p></blockquote><h4 id="当退出后再次运行失败" tabindex="-1"><a class="header-anchor" href="#当退出后再次运行失败"><span>当退出后再次运行失败</span></a></h4><p>他会说有另一个进程在运行，找到并删掉就好</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ./dperf -c client1.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Detected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CPU</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lcores:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Detected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NUMA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Detected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linkage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DPDK</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Cannot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lock</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/var/run/dpdk/rte/config&#39;.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> another</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> primary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> running?</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FATAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Cannot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EAL:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Cannot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rte_eal_init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fail</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk_eal_init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fail</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fail</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删掉：ps aux 找到：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>root       17595  2.0  0.1 67192540 13692 pts/1  Tl   07:25   0:07 ./dperf -c client1.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="同机器运行cs问题" tabindex="-1"><a class="header-anchor" href="#同机器运行cs问题"><span>同机器运行CS问题</span></a></h4><p>参考 dPerf 的 FAQ</p><p>例如分配了4G大页，那么就要给分别给2G，</p><ul><li>单NUMA系统：均 <code>socket_mem 2048</code></li><li>双NUMA系统：分别 <code>socket_mem 2048,0</code>、<code>socket_mem 0,2048</code></li></ul><h4 id="无三层交换机问题" tabindex="-1"><a class="header-anchor" href="#无三层交换机问题"><span>无三层交换机问题</span></a></h4><p>参考：https://dperf.org/doc/html/dperf-performance-testing-advanced</p><p>放同一网关就行</p><h2 id="dpdk初始化" tabindex="-1"><a class="header-anchor" href="#dpdk初始化"><span>DPDK初始化</span></a></h2><p>安装完后，还需要进行一些初始化操作</p><h3 id="配置大页" tabindex="-1"><a class="header-anchor" href="#配置大页"><span>配置大页</span></a></h3><p>手动</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-hugepages.py</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clear</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-hugepages.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --setup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 409600K</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 2*2048*1024=4GB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">modprobe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfio-pci</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-devbind.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfio-pci</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 04:00.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>./dpdk_env_init.sh</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 非零退出状态的命令时立即终止</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">GRUB_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/etc/default/grub&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">GRUB_FILE_TEMP</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/etc/default/grub.temp&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOCK_CORE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;isolcpus=1,2,3,4,5,6,7&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 系统隔离的逻辑核</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RESERVED_MEMORY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">3</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # 系统保留内存</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">is_modified</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (1) 检查GRUB_CMDLINE_LINUX_DEFAULT设置是否正确</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(1) GRUB_check&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ! </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash iommu=pt intel_iommu=on&quot;&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  sed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/^GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot;/GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash iommu=pt intel_iommu=on&quot;/&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$GRUB_FILE_TEMP</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  mv</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE_TEMP</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;GRUB_CMDLINE_LINUX_DEFAULT has been set to &#39;quiet splash iommu=pt intel_iommu=on&#39;.&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  is_modified</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (2) 检查GRUB_CMDLINE_LINUX设置是否正确</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(2) GRUB_check2&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ! </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;GRUB_CMDLINE_LINUX=</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOCK_CORE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 替换GRUB_CMDLINE_LINUX的值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  sed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/^GRUB_CMDLINE_LINUX=/s/</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[^</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]*</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOCK_CORE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$GRUB_FILE_TEMP</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 将修改后的临时文件覆盖原始文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  mv</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE_TEMP</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $GRUB_FILE</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;GRUB_CMDLINE_LINUX has been set to &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOCK_CORE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;.&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  is_modified</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (3) 如果有修改, 更新GRUB配置文件并提示重启</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(3) GRUB_change&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$is_modified</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -eq</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  update-grub</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;System will reboot in 30 seconds...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  sleep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  reboot</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 新增环境变量路径</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">usr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PacketMaster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scripts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DPDK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (4) 大页相关设置</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(4) HugePages Set&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-hugepages.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --clear</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 清除大页(hugepages)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mem_free</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MemFree</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/meminfo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">awk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -F:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{print $2}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39; kB&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取可用内存</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hugepage_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$((</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mem_free</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1024 </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) * RESERVED_MEMORY)) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># hugepage_size为 (可用内存-RESERVED_MEMORY)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hugepage_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$((</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hugepage_siz37e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2048</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2048</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-hugepages.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --setup</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hugepage_size</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">K</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 分配大页(hugepages)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 加载vfio-pci模块</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">modprobe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfio-pci</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (5) 绑定网卡</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(5) Bind Card&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 找到所有的非管理口网卡(目前只适配2600以及X10硬件, 如果后续管理口不是I211或者I210就需要修改)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nics</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpdk-devbind.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> drv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> I211</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> I210</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Active</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># grep -E &#39;0000:(02|82|81)&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 绑定非管理口网卡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> read</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nic_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  nic</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$nic_info</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">awk</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{print $1}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [[ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-z</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $nic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    continue</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  fi</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 开始解绑网卡</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;bind </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$nic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  dpdk-devbind.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfio-pci</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$nic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$nics</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (6) 其他环境检查</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(6) Other&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查 zip 是否已安装</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ! </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpkg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;zip is not installed, installing...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zip</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;zip was installed.&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查 net-tools 是否已安装</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ! </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpkg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net-tools</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dev/null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net-tools is not installed, installing...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net-tools</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net-tools was installed.&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;env init successfully.&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="dperf配置" tabindex="-1"><a class="header-anchor" href="#dperf配置"><span>Dperf配置</span></a></h2><h3 id="主要配置参数" tabindex="-1"><a class="header-anchor" href="#主要配置参数"><span>主要配置参数</span></a></h3><p>参考：https://dperf.org/doc/html/configuration</p><p>略</p><h3 id="统计查看" tabindex="-1"><a class="header-anchor" href="#统计查看"><span>统计查看</span></a></h3><p>客户端和服务端的统计是一样的</p><p>在运行的整个过程中显示的都是实时统计，没有累计统计：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>seconds 第几秒的统计        cpuUsage CPU使用情况</span></span>
<span class="line"><span>pktRx   收包数              pktTx   发包数             bitsRx   接收比特                  bitsTx  发送比特            dropTx  发送丢包</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tcpRx   TCP报文            tcpTx    TCP报文             udpRx    UDP报文                 udpTx   UDP报文 </span></span>
<span class="line"><span>arpRx   ARP报文            arpTx    ARP报文             icmpRx   ICMP报文                icmpTx  ICMP报文</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tosRx   0                  otherRx  0                  badRx    接收错包</span></span>
<span class="line"><span>udpRt   0                  udpDrop  udp丢包            tcpDrop  tcp丢包</span></span>
<span class="line"><span>skOpen  socket打开数       skClose  socket关闭数       skCon    socket连接数 (等同设置的cc项)   skErr   socket连接错误数             </span></span>
<span class="line"><span></span></span>
<span class="line"><span>ierrors 输入错误            oerrors  输出错误           imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>累计统计会在测试结束后给出：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-----------------------</span></span>
<span class="line"><span>dperf Test Finished</span></span>
<span class="line"><span>Version: 1.7.0-dev</span></span>
<span class="line"><span>License: Apache 2.0</span></span>
<span class="line"><span>Author:  Jianzhang Peng</span></span>
<span class="line"><span>-----------------------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Total Numbers:</span></span>
<span class="line"><span>pktRx   21                 pktTx    1,111              bitsRx   38,696             bitsTx  13,203,696         dropTx  0                </span></span>
<span class="line"><span>tcpRx   0                  tcpTx    0                  udpRx    13                 udpTx   1,100</span></span>
<span class="line"><span>arpRx   0                  arpTx    11                 icmpRx   0                  icmpTx  0</span></span>
<span class="line"><span>tosRx   0                  otherRx  8                  badRx    0</span></span>
<span class="line"><span>udpRt   1,000              udpDrop  13                 tcpDrop  0</span></span>
<span class="line"><span>skOpen  100                skClose  0                  skCon    100                skErr   0</span></span>
<span class="line"><span>ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，前面两个是UDP的，TCP的还会再多一些统计项处理：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>seconds 153                cpuUsage 0</span></span>
<span class="line"><span>pktRx   0                  pktTx    39,980             bitsRx   0                  bitsTx  19,830,080         dropTx  0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tcpRx   0                  tcpTx    39,980             udpRx    0                  udpTx   0</span></span>
<span class="line"><span>arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tosRx   0                  otherRx  0                  badRx    0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 这个部分不同</span></span>
<span class="line"><span>synRx   0                  synTx    39,980             finRx    0                  finTx   0                  rstRx   0          rstTx 0</span></span>
<span class="line"><span>synRt   39,980             finRt    0                  ackRt    0                  pushRt  0</span></span>
<span class="line"><span>tcpDrop 0                  udpDrop  0                  ackDup   0</span></span>
<span class="line"><span>skOpen  0                  skClose  19,990             skCon    80,020             skErr   19,990             rtt(us) 0.0 # TCP会多一个rtt，借此可以测试网络迟延</span></span>
<span class="line"><span>httpGet 0                  http2XX  0                  httpErr  0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="正式测试" tabindex="-1"><a class="header-anchor" href="#正式测试"><span>正式测试</span></a></h2><ul><li>server：0000:04:00.1、cpu1、port2480</li><li>client ：0000:04:00.0、cpu0</li></ul><h3 id="快速测试" tabindex="-1"><a class="header-anchor" href="#快速测试"><span>快速测试</span></a></h3><p>参考：https://dperf.org/doc/html/dperf-quick-start</p><p>server0.conf (亲测可用，但非双端测试)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode        server</span></span>
<span class="line"><span>cpu         1</span></span>
<span class="line"><span>duration    10m</span></span>
<span class="line"><span>port        0000:04:00.1    6.6.241.27   6.6.241.31</span></span>
<span class="line"><span>client      6.6.241.31      1</span></span>
<span class="line"><span>server      6.6.241.27      1</span></span>
<span class="line"><span>listen      80 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./dperf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server0.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="基础测试-新连接速率测试" tabindex="-1"><a class="header-anchor" href="#基础测试-新连接速率测试"><span>基础测试 - 新连接速率测试</span></a></h3><p>参考：https://dperf.org/doc/html/dperf-performance-testing-basic</p><p>server1.conf (亲测可用)</p><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># daemon</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mode            server</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cpu             1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration        3m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">payload_size    1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># numa2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">port            0000:04:00.1    6.6.247.3    6.6.247.1  b4:a9:fc:ab:7a:85</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client          6.6.245.3       100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server          6.6.247.3       1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">listen          2480              5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>服务器侦听 IP 6.6.247.3，端口范围为 80-84。</li><li>仅接受 6.6.245.3-6.6.245.102 范围内的客户端地址。源地址超出此范围的 TCP 数据包将被丢弃或重置。 Ping 不受影响。</li><li>服务器绑定到具有互连 IP 6.6.247.3（重用侦听 IP）和网关 6.6.247.1（交换机 IP）的单个网络接口。</li><li>新连接速率测试中无法开启Keepalive。</li><li>将 HTTP 响应长度设置为最小值： <code>payload_size 1</code></li></ul><p>client-newCC.conf (亲测可用)</p><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">payload_size    1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cps             2.1m</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port           pci             addr      gateway        </span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mac</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">port            0000:04:00.0    6.6.245.3 6.6.245.1  b4:a9:fc:ab:7a:85</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client          6.6.245.3       100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server          6.6.247.3       1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">listen          2480              5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>客户端以服务器的监听地址为目标。 IP为6.6.247.3，端口范围为80-84。</li><li>客户端使用地址池中的IP地址：6.6.245.3-6.6.245.102。</li><li>客户端绑定到具有互连 IP 6.6.245.3（重用池中的地址）和网关 6.6.245.1（交换机 IP）的单个网络接口。</li><li>将 HTTP 响应长度设置为最小值： <code>payload_size 1</code></li><li>将 CPS (每秒连接数) 目标设置为 200 万。根据CPU容量灵活调整CPS值。建议从较小的值开始，例如“10k”。</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Run the server</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./dperf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server1.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Run the client</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./dperf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> client1.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="基础测试-并发连接测试" tabindex="-1"><a class="header-anchor" href="#基础测试-并发连接测试"><span>基础测试 - 并发连接测试</span></a></h3><p>client-concurrentConnections.conf</p><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">payload_size    1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration        10m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cps             0.5m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cc              100m</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">keepalive       60s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port           pci             addr      gateway    </span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mac</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">port            0000:04:00.0    6.6.245.3 6.6.245.1  b4:a9:fc:ab:7a:85</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client          6.6.245.3       100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server          6.6.247.3       1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">listen          80              32</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>客户端配置已针对并发连接测试进行调整。</li><li>Keepalive 设置为 60 秒以维持长期连接。</li><li>CPS 目标设定为 50 万。</li><li>CC（并发连接数）设置为1亿。根据您的具体测试要求调整这些值。</li></ul><h3 id="基础测试-带宽测试" tabindex="-1"><a class="header-anchor" href="#基础测试-带宽测试"><span>基础测试 - 带宽测试</span></a></h3><p>带宽测试建立在并发连接测试的基础上：</p><ul><li>通过将 <code>payload_size</code> 设置为 1400 来增加消息长度。</li><li>减少并发连接数，例如将 <code>cc</code> 设置为3000。</li><li>提高请求发送速度，例如每 1 毫秒发送一次请求。</li><li>由于并发级别较低，CPS 较低。</li></ul><p>client-bandwidth.conf</p><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">payload_size    1400</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration        10m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cps             10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cc              10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">keepalive       60s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port           pci             addr      gateway    </span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mac</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">port            0000:04:00.0    6.6.245.3 6.6.245.1  b4:a9:fc:ab:7a:85</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client          6.6.245.3       5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server          6.6.247.3       1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">listen          2480              32</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="基础测试-pps测试" tabindex="-1"><a class="header-anchor" href="#基础测试-pps测试"><span>基础测试 - PPS测试</span></a></h3><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">payload_size    1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cps             400</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">cc              3000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port           pci             addr         gateway    </span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mac</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">port            0000:01:00.0    6.6.245.3   6.6.245.1   b4:a9:fc:ab:7a:85</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client          6.6.245.3        100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># addr_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server          6.6.247.3       1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># port_start      num</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">listen          80              5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>对于最小数据包长度，有效负载大小设置为 1 字节。</li></ul><h2 id="个人自用测试项" tabindex="-1"><a class="header-anchor" href="#个人自用测试项"><span>个人自用测试项</span></a></h2><p>参考：https://dperf.org/doc/html/configuration</p><p>另外注意：</p><ul><li>哪怕在注释里，也不能有中文，否则直接不会运行也不会报错</li><li>不支持行尾注释，注释只能单独一行</li><li>逗号后面不要加空格</li></ul><h3 id="_3000并发1ms" tabindex="-1"><a class="header-anchor" href="#_3000并发1ms"><span>3000并发1ms</span></a></h3><p>client.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># payload_size  1400</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             300</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              3000</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pipeline        0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.11 6.6.245.1  b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.1       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            server</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Server setup</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># send_window</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.1    6.6.245.2  6.6.245.1  b4:a9:fc:ab:7a:80</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10k并发1ms" tabindex="-1"><a class="header-anchor" href="#_10k并发1ms"><span>10k并发1ms</span></a></h3><p>client.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># payload_size  1400</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             1k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.11 6.6.245.1  b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.1       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            server</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Server setup</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># send_window</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.1    6.6.245.2  6.6.245.1  b4:a9:fc:ab:7a:80</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_200-ip-x-512-port-10k-并发" tabindex="-1"><a class="header-anchor" href="#_200-ip-x-512-port-10k-并发"><span>200 ip x 512 port = 10k 并发</span></a></h3><p>参考：https://blog.51cto.com/u_11529070/9214521，但弱化了一些参数，万用表100k就崩了</p><p>client.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             1k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1 512</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.11 6.6.245.1  b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      200</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.1       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            server</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Server setup</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># send_window</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.1    6.6.245.2  6.6.245.1  b4:a9:fc:ab:7a:80</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      200</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1488095pps" tabindex="-1"><a class="header-anchor" href="#_1488095pps"><span>1488095pps</span></a></h3><p>复习一下</p>`,122),s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mtable",{rowspacing:"0.25em",columnalign:"right left right left",columnspacing:"0em 1em 0em"},[s("mtr",null,[s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mn",null,"148809523")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"∗"),s("mn",null,"8"),s("mo",null,"∗"),s("mo",{stretchy:"false"},"("),s("mn",null,"64"),s("mo",null,"+"),s("mn",null,"12"),s("mo",null,"+"),s("mn",null,"8"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mn",null,"99999999456")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"="),s("mn",null,"100"),s("mi",null,"G")])])])]),s("mtr",null,[s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mo",{stretchy:"false"},"("),s("mtext",null,"千万包"),s("mo",{stretchy:"false"},")"),s("mtext",null," "),s("mn",null,"14880952")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"∗"),s("mn",null,"8"),s("mo",null,"∗"),s("mo",{stretchy:"false"},"("),s("mn",null,"64"),s("mo",null,"+"),s("mn",null,"12"),s("mo",null,"+"),s("mn",null,"8"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mn",null,"9999999744")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"="),s("mn",null,"10"),s("mi",null,"G")])])])]),s("mtr",null,[s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mo",{stretchy:"false"},"("),s("mtext",null,"百万包"),s("mo",{stretchy:"false"},")"),s("mtext",null," "),s("mn",null,"1488095")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"∗"),s("mn",null,"8"),s("mo",null,"∗"),s("mo",{stretchy:"false"},"("),s("mn",null,"64"),s("mo",null,"+"),s("mn",null,"12"),s("mo",null,"+"),s("mn",null,"8"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mn",null,"999999840")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"="),s("mn",null,"1"),s("mi",null,"G")])])])]),s("mtr",null,[s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mn",null,"148809")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"∗"),s("mn",null,"8"),s("mo",null,"∗"),s("mo",{stretchy:"false"},"("),s("mn",null,"64"),s("mo",null,"+"),s("mn",null,"12"),s("mo",null,"+"),s("mn",null,"8"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mn",null,"99999648")])])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow")])]),s("mtd",null,[s("mstyle",{scriptlevel:"0",displaystyle:"true"},[s("mrow",null,[s("mrow"),s("mo",null,"="),s("mn",null,"100"),s("mi",null,"M")])])])])]),s("annotation",{encoding:"application/x-tex"},"\\begin{aligned} 148809523 &*8*(64+12+8)=99999999456 &&=100G\\\\ (千万包)~14880952 &*8*(64+12+8)=9999999744 &&=10G\\\\ (百万包)~1488095 &*8*(64+12+8)=999999840 &&=1G\\\\ 148809 &*8*(64+12+8)=99999648 &&=100M\\\\ \\end{aligned} ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"6em","vertical-align":"-2.75em"}}),s("span",{class:"mord"},[s("span",{class:"mtable"},[s("span",{class:"col-align-r"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"3.25em"}},[s("span",{style:{top:"-5.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"148809523")])]),s("span",{style:{top:"-3.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mopen"},"("),s("span",{class:"mord cjk_fallback"},"千万包"),s("span",{class:"mclose"},")"),s("span",{class:"mspace nobreak"}," "),s("span",{class:"mord"},"14880952")])]),s("span",{style:{top:"-2.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mopen"},"("),s("span",{class:"mord cjk_fallback"},"百万包"),s("span",{class:"mclose"},")"),s("span",{class:"mspace nobreak"}," "),s("span",{class:"mord"},"1488095")])]),s("span",{style:{top:"-0.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"148809")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"2.75em"}},[s("span")])])])]),s("span",{class:"col-align-l"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"3.25em"}},[s("span",{style:{top:"-5.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},"64"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"12"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"99999999456")])]),s("span",{style:{top:"-3.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},"64"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"12"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"9999999744")])]),s("span",{style:{top:"-2.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},"64"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"12"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"999999840")])]),s("span",{style:{top:"-0.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},"64"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"12"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mord"},"8"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"99999648")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"2.75em"}},[s("span")])])])]),s("span",{class:"arraycolsep",style:{width:"1em"}}),s("span",{class:"col-align-r"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"3.25em"}},[s("span",{style:{top:"-5.25em"}},[s("span",{class:"pstrut",style:{height:"2.84em"}}),s("span",{class:"mord"})]),s("span",{style:{top:"-3.75em"}},[s("span",{class:"pstrut",style:{height:"2.84em"}}),s("span",{class:"mord"})]),s("span",{style:{top:"-2.25em"}},[s("span",{class:"pstrut",style:{height:"2.84em"}}),s("span",{class:"mord"})]),s("span",{style:{top:"-0.75em"}},[s("span",{class:"pstrut",style:{height:"2.84em"}}),s("span",{class:"mord"})])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"2.75em"}},[s("span")])])])]),s("span",{class:"col-align-l"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"3.25em"}},[s("span",{style:{top:"-5.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"100"),s("span",{class:"mord mathnormal"},"G")])]),s("span",{style:{top:"-3.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"10"),s("span",{class:"mord mathnormal"},"G")])]),s("span",{style:{top:"-2.41em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"1"),s("span",{class:"mord mathnormal"},"G")])]),s("span",{style:{top:"-0.91em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"}),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mord"},"100"),s("span",{class:"mord mathnormal",style:{"margin-right":"0.10903em"}},"M")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"2.75em"}},[s("span")])])])])])])])])])])],-1),a(`<h3 id="单连接大流" tabindex="-1"><a class="header-anchor" href="#单连接大流"><span>单连接大流</span></a></h3><p>client.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># payload_size  1400</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             1k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.11 6.6.245.1  b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.1       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server.conf</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            server</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        2m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Server setup</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># send_window</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       10us</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Network topology setting</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port          pci             addr       gateway    [mac]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.1    6.6.245.2  6.6.245.1  b4:a9:fc:ab:7a:80</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># addr_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># port_start    num</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_20k连接速度-tcp" tabindex="-1"><a class="header-anchor" href="#_20k连接速度-tcp"><span>20k连接速度 tcp</span></a></h3><p>参考：https://blog.51cto.com/u_11529070/9214521，但弱化了一些参数，万用表100k就崩了</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            client</span></span>
<span class="line"><span>tx_burst        128</span></span>
<span class="line"><span>launch_num      10</span></span>
<span class="line"><span>cpu             0</span></span>
<span class="line"><span>socket_mem      2048</span></span>
<span class="line"><span></span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span>duration        2m</span></span>
<span class="line"><span>cps             20k</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#port           pci             addr      gateway        [mac]</span></span>
<span class="line"><span>port            0000:04:00.0    6.6.245.11 6.6.245.1  b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#               addr_start      num</span></span>
<span class="line"><span>client          6.6.245.11		20</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#               addr_start      num</span></span>
<span class="line"><span>server          6.6.245.2       1</span></span>
<span class="line"><span>#               port_start      num</span></span>
<span class="line"><span>listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#daemon</span></span>
<span class="line"><span>mode            server</span></span>
<span class="line"><span>tx_burst        128</span></span>
<span class="line"><span>cpu             7</span></span>
<span class="line"><span>socket_mem      1920</span></span>
<span class="line"><span></span></span>
<span class="line"><span>duration        3m</span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#numa2</span></span>
<span class="line"><span>port            0000:04:00.1    6.6.245.2  6.6.245.1  b4:a9:fc:ab:7a:80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#               addr_start      num</span></span>
<span class="line"><span>client          6.6.245.11		20</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#               addr_start      num</span></span>
<span class="line"><span>server          6.6.245.2       1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#               port_start      num</span></span>
<span class="line"><span>listen          2480            1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1m-pps-大象流" tabindex="-1"><a class="header-anchor" href="#_1m-pps-大象流"><span>1M PPS 大象流</span></a></h3><p>参考：https://dperf.org/doc/html/elephant</p><p>在之前的版本中，dperf 对于单个连接来说，单向最大 PPS 为 100K，两个方向最大 PPS 为 200K。在某些场景下，我们需要测试单流1M PPS，这种高PPS的流称为大象流。本文介绍如何配置 dperf 来测试单流 1M PPS。注意大象流仅支持UDP协议。</p><p>核心配置：</p><ul><li>pipeline。原来的dperf客户端需要收到服务器的响应后才能发送下一个请求；使用pipeline可以一次发送多个请求，类似于http的pipeline请求；这样PPS就可以翻倍。</li><li>keepalive。 dperf原来的keepalive间隔只能配置为最小10us，现在可以配置为最小0。更小的间隔可以让dperf更快地发送请求。</li><li>flood。这是单向流的开关，表示连接不需要等待响应。</li></ul><h4 id="单向大象流配置示例" tabindex="-1"><a class="header-anchor" href="#单向大象流配置示例"><span>单向大象流配置示例</span></a></h4><p>服务器配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            server</span></span>
<span class="line"><span>protocol        udp</span></span>
<span class="line"><span>tx_burst        4</span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span>keepalive       1s</span></span>
<span class="line"><span>cpu             1</span></span>
<span class="line"><span>duration        2h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            client</span></span>
<span class="line"><span>protocol        udp</span></span>
<span class="line"><span>tx_burst        4</span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span>keepalive       1us</span></span>
<span class="line"><span>pipeline        1</span></span>
<span class="line"><span>cc        1</span></span>
<span class="line"><span>flood</span></span>
<span class="line"><span>cpu             0</span></span>
<span class="line"><span>duration        1h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="双向大象流配置示例" tabindex="-1"><a class="header-anchor" href="#双向大象流配置示例"><span>双向大象流配置示例</span></a></h4><p>server configuration 服务器配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            server</span></span>
<span class="line"><span>protocol        udp</span></span>
<span class="line"><span>tx_burst        4</span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span>keepalive       1s</span></span>
<span class="line"><span>cpu             1</span></span>
<span class="line"><span>duration        2h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>client configuration 客户端配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            client</span></span>
<span class="line"><span>protocol        udp</span></span>
<span class="line"><span>tx_burst        4</span></span>
<span class="line"><span>payload_size    1</span></span>
<span class="line"><span>keepalive       0us</span></span>
<span class="line"><span>socket_mem      2048</span></span>
<span class="line"><span>pipeline        10</span></span>
<span class="line"><span>cc        1</span></span>
<span class="line"><span>cpu             0</span></span>
<span class="line"><span>duration        1h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_100g带宽" tabindex="-1"><a class="header-anchor" href="#_100g带宽"><span>100G带宽</span></a></h3><p>参考：https://zhuanlan.zhihu.com/p/601137162</p><p>客户端 12核x10网口x65535端口 -&gt; 12核x12网口x1端口，1450大小</p><p>cc 8000、cps2000</p><h3 id="向大量-ip-发送" tabindex="-1"><a class="header-anchor" href="#向大量-ip-发送"><span>向大量 IP 发送</span></a></h3><p>参考：https://dperf.org/doc/html/dperf-change-dip</p><h3 id="http服务" tabindex="-1"><a class="header-anchor" href="#http服务"><span>HTTP服务</span></a></h3><p>参考：https://dperf.org/doc/html/dperf-http-server</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mode            server</span></span>
<span class="line"><span>protocol        http # 关键设置</span></span>
<span class="line"><span>jumbo           9000</span></span>
<span class="line"><span>tx_burst        6</span></span>
<span class="line"><span></span></span>
<span class="line"><span>payload_size    1m</span></span>
<span class="line"><span>send_window     6</span></span>
<span class="line"><span></span></span>
<span class="line"><span>keepalive       1s</span></span>
<span class="line"><span>cpu             0</span></span>
<span class="line"><span>duration        100m</span></span>
<span class="line"><span>port            0000:00:06.0    192.168.4.2    192.168.4.3</span></span>
<span class="line"><span>client          192.168.4.3     1</span></span>
<span class="line"><span>server          192.168.4.2     1</span></span>
<span class="line"><span>listen          80              1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="计算备注" tabindex="-1"><a class="header-anchor" href="#计算备注"><span>计算备注</span></a></h3><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>总连接数</mtext><mo>=</mo><mtext>客户端</mtext><mi>I</mi><mi>P</mi><mtext>数</mtext><mo>∗</mo><mn>65535</mn><mo>∗</mo><mtext>服务器</mtext><mi>I</mi><mi>P</mi><mtext>数</mtext><mo>∗</mo><mtext>监听端口数</mtext></mrow><annotation encoding="application/x-tex">总连接数=客户端IP数*65535*服务器IP数*监听端口数</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">总连接数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">客户端</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback">数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">65535</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">服务器</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback">数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">监听端口数</span></span></span></span></p><p>socket数计算</p><ul><li>例如： <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>客户端端口 </mtext><mn>65536</mn><mo>×</mo><mtext>客户端</mtext><mi>I</mi><mi>P</mi><mtext> </mtext><mn>20</mn><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mtext>服务端</mtext><mi>I</mi><mi>P</mi><mtext> </mtext><mn>1</mn><mo>×</mo><mtext>服务端端口 </mtext><mn>20</mn><mo stretchy="false">)</mo><mo>=</mo><mn>26214000</mn></mrow><annotation encoding="application/x-tex">(客户端端口~65536\\times客户端IP~20)\\times(服务端IP~1\\times服务端端口~20) = 26214000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">客户端端口</span><span class="mspace nobreak"> </span><span class="mord">65536</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">客户端</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace nobreak"> </span><span class="mord">20</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">服务端</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace nobreak"> </span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">服务端端口</span><span class="mspace nobreak"> </span><span class="mord">20</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">26214000</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo><mn>80</mn><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">/</mi><mn>1</mn><mi>G</mi><mi>B</mi><mo>=</mo><mtext>内存大小</mtext><mn>1.95</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">*80Byte/1GB= 内存大小1.95GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∗</span><span class="mord">80</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord">/1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">内存大小</span><span class="mord">1.95</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>客户端端口 </mtext><mn>65536</mn><mo>×</mo><mtext>客户端</mtext><mi>I</mi><mi>P</mi><mtext> </mtext><mn>10</mn><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mtext>服务端</mtext><mi>I</mi><mi>P</mi><mtext> </mtext><mn>1</mn><mo>×</mo><mtext>服务端端口 </mtext><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>06553500</mn></mrow><annotation encoding="application/x-tex">(客户端端口~65536\\times客户端IP~10)\\times(服务端IP~1\\times服务端端口~10) = 06553500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">客户端端口</span><span class="mspace nobreak"> </span><span class="mord">65536</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">客户端</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace nobreak"> </span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">服务端</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace nobreak"> </span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">服务端端口</span><span class="mspace nobreak"> </span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">06553500</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo><mn>80</mn><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">/</mi><mn>1</mn><mi>G</mi><mi>B</mi><mo>=</mo><mtext>内存大小</mtext><mn>0.49</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">*80Byte/1GB = 内存大小0.49GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∗</span><span class="mord">80</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord">/1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">内存大小</span><span class="mord">0.49</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span></span></span></span></li></ul></li></ul><h2 id="性能" tabindex="-1"><a class="header-anchor" href="#性能"><span>性能</span></a></h2><h3 id="dperf标榜性能" tabindex="-1"><a class="header-anchor" href="#dperf标榜性能"><span>Dperf标榜性能</span></a></h3><p>见大象流</p><p>在之前的版本中，dperf 对于单个连接来说，单向最大 PPS 为 100K，两个方向最大 PPS 为 200K。在某些场景下，我们需要测试单流1M PPS，这种高PPS的流称为大象流。本文介绍如何配置 dperf 来测试单流 1M PPS。注意大象流仅支持UDP协议。</p><h3 id="基准测试" tabindex="-1"><a class="header-anchor" href="#基准测试"><span>基准测试</span></a></h3><p>机器参数</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>卡：</span></span>
<span class="line"><span>04:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CPU</span></span>
<span class="line"><span>ip:                  1.208</span></span>
<span class="line"><span>Model name:            Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz</span></span>
<span class="line"><span>CPU(s):                  8</span></span>
<span class="line"><span>CPU max MHz:         4000.0000</span></span>
<span class="line"><span>CPU min MHz:         800.0000</span></span>
<span class="line"><span>Caches (sum of all):</span></span>
<span class="line"><span>  L1d:                   128 KiB (4 instances)</span></span>
<span class="line"><span>  L1i:                   128 KiB (4 instances)</span></span>
<span class="line"><span>  L2:                    1 MiB (4 instances)</span></span>
<span class="line"><span>  L3:                    8 MiB (1 instance)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>内存：</span></span>
<span class="line"><span>总大页：4194304K = 4G</span></span>
<span class="line"><span>配置分出：1920*2MB = 3840MB (3.75G)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="udp-cc-1000k" tabindex="-1"><a class="header-anchor" href="#udp-cc-1000k"><span>UDP CC-1000k</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用资源：1000k * 80Byte * 2 = 0.08G * 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.121 6.6.245.1   b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        1m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1 100</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              1000k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 发送端：发1.4Mpps(计发送丢包可5Mpps) * 64*8bpp ~= 777Mbps，收53Kpps * 64*8bpp ~= 3.4MB，连接数360k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 50                 cpuUsage 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   53,235             pktTx    4,659,163          bitsRx   27,256,320         bitsTx  2,385,491,456      dropTx  3,254,020</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   0                  tcpTx    0                  udpRx    53,235             udpTx   4,659,163</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">udpRt   4,598,815          udpDrop  0                  tcpDrop  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  8,580              skClose  0                  skCon    358,240            skErr   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  49,808,123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 接收端：收发 1.4Mpps * 64*8bpp ~= 718Mbps</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 59                 cpuUsage 44</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   1,403,848          pktTx    1,403,848          bitsRx   718,770,176        bitsTx  718,770,176        dropTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   0                  tcpTx    0                  udpRx    1,403,848          udpTx   1,403,848</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">udpRt   0                  udpDrop  0                  tcpDrop  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  0                  skClose  0                  skCon    0                  skErr   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="udp-cc-10000k" tabindex="-1"><a class="header-anchor" href="#udp-cc-10000k"><span>UDP CC-10000k</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用资源：10000k * 80Byte * 2 = 0.75G * 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.121 6.6.245.1   b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        1m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1us</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1 1000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              10000k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 结果，同上，本来就只能到350k</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="tcp-cc-1000k" tabindex="-1"><a class="header-anchor" href="#tcp-cc-1000k"><span>TCP CC-1000k</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用资源：1000k * 80Byte * 2 = 0.08G * 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.121 6.6.245.1   b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        1m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        tcp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1 100</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              1000k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 发送端：收发 1.4Mpps(计发送丢包可1.5Mpps) * 64*8bpp ~= 777Mbps (满1G，他这里的统计不算前导码和帧间隙的)，连接数211k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 35                 cpuUsage 49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   1,420,809          pktTx    1,517,316          bitsRx   727,294,512        bitsTx  776,695,536        dropTx  94,611</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   1,420,809          tcpTx    1,517,316          udpRx    0                  udpTx   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRx   9,981              synTx    10,641             finRx    0                  finTx   0                  rstRx   0          rstTx 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRt   641                finRt    0                  ackRt    0                  pushRt  91,301</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpDrop 5,393              udpDrop  0                  ackDup   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  10,000             skClose  152                skCon    211,166            skErr   152</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpReq  1,506,675          tcpRsp   1,405,435</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  34,902</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 服务端：同上</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 60                 cpuUsage 49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   1,420,782          pktTx    1,459,046          bitsRx   727,279,136        bitsTx  746,865,776        dropTx  38,793</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   1,420,782          tcpTx    1,459,046          udpRx    0                  udpTx   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRx   10,078             synTx    10,361             finRx    0                  finTx   0                  rstRx   0          rstTx 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRt   410                finRt    0                  ackRt    0                  pushRt  62,280</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpDrop 24,299             udpDrop  0                  ackDup   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  9,951              skClose  718                skCon    438,470            skErr   718</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpReq  1,386,405          tcpRsp   1,448,685</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="http-cc-1000k" tabindex="-1"><a class="header-anchor" href="#http-cc-1000k"><span>HTTP CC-1000k</span></a></h4><p>仅修改包大小和协议（非64帧长似乎有些怪）</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用资源：1000k * 80Byte * 2 = 0.08G * 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      1920</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.121 6.6.245.1   b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        1m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        http</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1ms</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1 100</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        128</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cps             10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              1000k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 发送端：发 1.4Mpps(计发送丢包可1.7Mpps，接收少了，相较于tcp反而高了) * 128*8bpp = 1523MB &lt; 817MB ，，连接数371k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 52                 cpuUsage 69</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   803,396            pktTx    1,716,083          bitsRx   817,265,504        bitsTx  817,507,840        dropTx  306,787</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   803,396            tcpTx    1,716,083          udpRx    0                  udpTx   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRx   10,250             synTx    12,031             finRx    0                  finTx   0                  rstRx   0          rstTx 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRt   2,171              finRt    0                  ackRt    0                  pushRt  170,892</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpDrop 31,499             udpDrop  0                  ackDup   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  9,860              skClose  2,094              skCon    371,192            skErr   2,094</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">httpGet 942,375            http2XX  761,677            httpErr  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  19,883</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 服务端：同上</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 52                 cpuUsage 41</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   1,429,757          pktTx    828,705            bitsRx   711,520,720        bitsTx  842,996,592        dropTx  10,111</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   1,429,757          tcpTx    828,705            udpRx    0                  udpTx   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRx   10,105             synTx    10,601             finRx    0                  finTx   0                  rstRx   0          rstTx 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">synRt   546                finRt    0                  ackRt    0                  pushRt  38,344</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpDrop 3,855              udpDrop  0                  ackDup   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  10,055             skClose  961                skCon    362,167            skErr   961</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">httpGet 0                  http2XX  818,104            httpErr  779,760</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="单端极限pps" tabindex="-1"><a class="header-anchor" href="#单端极限pps"><span>单端极限pps</span></a></h4><p>修改了tx_burst、flood、pipeline、launch_num、cc</p><p>仅发送不接收</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 (尝试使pps达到最大)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用资源：2000k * 80Byte = 0.15G</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Occupy resource Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mode            client</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu             0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">socket_mem      3840</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port            0000:04:00.0    6.6.245.11  6.6.245.1   b4:a9:fc:ab:7a:91</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># General Settings</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">duration        1m</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol        udp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">packet_size     64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client          6.6.245.11      20</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server          6.6.245.2       1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">listen          2480            10</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lport_range     1               10</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Client setup</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">keepalive       1us</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tx_burst        1024</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">launch_num      1000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cps             10k</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cc              100</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">flood</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pipeline        100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 发送端：udp含丢包6.2Mpps、tcp和http均5.8Mpps (由于单端，全发的syn包，非udp无法开启pipeline选项)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds 21                 cpuUsage 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pktRx   0                  pktTx    6,288,524          bitsRx   0                  bitsTx  3,219,724,288      dropTx  6,287,360</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tcpRx   0                  tcpTx    0                  udpRx    0                  udpTx   6,288,524</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">arpRx   0                  arpTx    0                  icmpRx   0                  icmpTx  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tosRx   0                  otherRx  0                  badRx    0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">udpRt   0                  udpDrop  0                  tcpDrop  0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">skOpen  0                  skClose  0                  skCon    100                skErr   0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ierrors 0                  oerrors  0                  imissed  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="图" tabindex="-1"><a class="header-anchor" href="#图"><span>图</span></a></h4><h4 id="收发形式-抓包" tabindex="-1"><a class="header-anchor" href="#收发形式-抓包"><span>收发形式 (抓包)</span></a></h4>`,59)]))}const d=n(p,[["render",t],["__file","dperf.html.vue"]]),r=JSON.parse('{"path":"/MdNote_Public/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/Perf/dperf.html","title":"dperf","lang":"zh-CN","frontmatter":{"description":"DPDK环境部分 (不建议先单独安装DPDK，而是按DPerf的说明安装DPDK) 参考 官网：https://www.dpdk.org/ 下载：http://core.dpdk.org/download/ 安装：http://core.dpdk.org/doc/quick-start/ 文档：https://doc.dpdk.org/guides/l...","head":[["meta",{"property":"og:url","content":"https://LincZero.github.io/MdNote_Public/01.%20DesignAndDevelop/Develop/02.%20Theory/Computer/03.%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%20-%20%E4%B8%93%E9%A2%98%E6%88%96%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%97%E5%85%B8%E7%89%88/%E4%B8%8B%E5%B1%82%E7%9B%B8%E5%85%B3/Network/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/Perf/dperf.html"}],["meta",{"property":"og:site_name","content":"Linc 的小站"}],["meta",{"property":"og:description","content":"DPDK环境部分 (不建议先单独安装DPDK，而是按DPerf的说明安装DPDK) 参考 官网：https://www.dpdk.org/ 下载：http://core.dpdk.org/download/ 安装：http://core.dpdk.org/doc/quick-start/ 文档：https://doc.dpdk.org/guides/l..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LincZero\\",\\"url\\":\\"https://github.com/LincZero/\\"}]}"]]},"git":{},"readingTime":{"minutes":20.31,"words":6092},"filePathRelative":"MdNote_Public/01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络工具/Perf/dperf.md","excerpt":"<h2>DPDK环境部分 (不建议先单独安装DPDK，而是按DPerf的说明安装DPDK)</h2>\\n<h3>参考</h3>\\n<ul>\\n<li>官网：https://www.dpdk.org/</li>\\n<li>下载：http://core.dpdk.org/download/</li>\\n<li>安装：http://core.dpdk.org/doc/quick-start/</li>\\n<li>文档：https://doc.dpdk.org/guides/linux_gsg/index.html</li>\\n</ul>\\n<h3>安装</h3>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">tar</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> xf</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dpdk.tar.gz</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\\">cd</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dpdk</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">meson</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> build</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">ninja</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -C</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> build</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 安装</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\\">cd</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> build</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">ninja</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">meson</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> install</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">ldconfig</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 安装后的二进制库路径：/usr/local/lib/x86_64-linux-gnu/</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 安装后的头文件路径：/usr/local/include/</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true,"bioChainData":{"outlink":[],"backlink":[],"localMap":{"nodes":[{"id":"MdNote_Public/01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络工具/Perf/dperf.md","value":{"title":"dperf","path":"MdNote_Public/01. DesignAndDevelop/Develop/02. Theory/Computer/03. 计算机系统 - 专题或子系统的字典版/下层相关/Network/网络工具/Perf/dperf.md","outlink":[],"backlink":[]}}],"links":[]}}}');export{d as comp,r as data};
